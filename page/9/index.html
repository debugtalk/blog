<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.0.1">


  <link rel="mask-icon" href="/images/safari-pinned-tab.svg?v=7.0.1" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true,"dimmer":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>

<script>
  (function(i,s,o,g,r,a,m){i["SlardarMonitorObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://i.snssdk.com/slardar/sdk.js?bid=debugtalk","Slardar");
</script>
<script>
  window.Slardar('config', {
    sampleRate: 1,
    bid: 'debugtalk',
    ignoreAjax: [],
    ignoreStatic: [],
    hookFetch: true,
    enableSizeStats: true
  });
  window.Slardar('send', 'pageview');
</script>



  

<script>
  (function(i,s,o,g,r,a,m){i["SlardarMonitorObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://i.snssdk.com/slardar/sdk.js?bid=debugtalk","Slardar");
</script>
<script>
  window.Slardar('config', {
    sampleRate: 1,
    bid: 'debugtalk',
    ignoreAjax: [],
    ignoreStatic: [],
    hookFetch: true,
    enableSizeStats: true
  });
  window.Slardar('send', 'pageview');
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="DebugTalk">
<meta property="og:url" content="https://debugtalk.com/page/9/index.html">
<meta property="og:site_name" content="DebugTalk">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DebugTalk">



  <link rel="alternate" href="/atom.xml" title="DebugTalk" type="application/atom+xml">




  <link rel="canonical" href="https://debugtalk.com/page/9/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>DebugTalk</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=[object Object]"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-81639610-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DebugTalk</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">探索一个软件工程师的无限可能</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/debugtalk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/blackbox-testing-method-equivalence-partitioning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/blackbox-testing-method-equivalence-partitioning/" class="post-title-link" itemprop="url">黑盒测试用例设计技术--等价类划分法</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-03-18 00:00:00" itemprop="dateCreated datePublished" datetime="2015-03-18T00:00:00+08:00">2015-03-18</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/功能测试/" itemprop="url" rel="index"><span itemprop="name">功能测试</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文通过案例的形式，详细讲解黑盒测试用例设计技术中的等价类划分法。</p>
<p>等价类划分是一种典型的黑盒测试方法，其原理是把程序的输入域划分成若干部分（子集），然后从每一个子集中选取少数具有代表性的数据作为测试用例。</p>
<p>通过等价类划分，可以在尽可能覆盖所有测试路径的前提下，大幅度减少测试用例的数目。</p>
<p>本文的主要内容有：</p>
<ul>
<li>等价类的概念介绍</li>
<li>划分等价类的原则</li>
<li>根据等价类设计测试用例的方法</li>
<li>案例演示</li>
</ul>
<h2 id="划分等价类"><a href="#划分等价类" class="headerlink" title="划分等价类"></a>划分等价类</h2><p>等价类是指某个输入域的子集合。在该子集合中，各个输入数据对于揭露程序中的错误都是等效的。并合理的假设，测试某等价类的代表值就等于对这一类其它值的测试。</p>
<p>等价类划分有两种不同的情况：</p>
<ul>
<li>有效等价类：指对于程序的规格说明来说是合理的、有意义的输入数据构成的集合。</li>
<li>无效等价类：指对程序的规格说明是不合理的或无意义的输入数据所构成的集合。对于具体的问题，无效等价类至少应有一个，也可能有多个。</li>
</ul>
<p>在设计测试用例时，要同时考虑有效等价类和无效等价类，以此验证软件在正常操作和异常操作时是否都能正常运行。</p>
<p>确定等价类的6条原则：</p>
<p>１、在输入条件规定了取值范围或取值的个数的情况下，可以确立一个有效等价类和两个无效等价类。</p>
<ul>
<li>例1：输入值是学生成绩，输入形式为文本框，要求的输入范围是0～100<ul>
<li>有效等价类：0&lt;=输入成绩&lt;=100；</li>
<li>无效等价类1：输入成绩&lt;0；</li>
<li>无效等价类2：输入成绩&gt;100</li>
</ul>
</li>
</ul>
<p>２、在输入条件规定了输入值的集合或者规定了“必须如何”的条件的情况下，可以确立一个有效等价类和一个无效等价类。</p>
<ul>
<li>例2：输入值是人员性别，输入形式为文本框，要求输入的内容必须在集合{男,女}中<ul>
<li>有效等价类：性别＝’男’ 或者 ‘女’</li>
<li>无效等价类：性别＝’人妖’</li>
</ul>
</li>
</ul>
<p>３、在输入条件是一个布尔量的情况下，可以确立一个有效等价类和一个无效等价类。</p>
<ul>
<li>例3：输入值是状态标识位“是否完成”，输入形式为单选下拉框，选择范围为{是,否}<ul>
<li>有效等价类：选项＝’是’ 或者 ‘否’</li>
<li>无效等价类：未进行选择操作</li>
</ul>
</li>
</ul>
<p>４、在规定了输入数据的一组值（假设Ｎ个），并且程序要对每一个输入值进行处理的情况下，可以确立Ｎ个有效等价类和一个无效等价类。</p>
<ul>
<li>例4：输入值是人员性别，输入形式为文本框，要求输入的内容必须在集合{男,女}中；不同的性别选择将跳转至不同的处理页面<ul>
<li>有效等价类1：性别＝’男’</li>
<li>有效等价类2：性别＝’女’</li>
<li>无效等价类：性别＝’人妖’</li>
</ul>
</li>
</ul>
<p>５、在规定了输入数据必须遵守的规则的情况下，可以确立一个有效等价类（符合条件）和若干无效等价类（从各个角度违反规则）。</p>
<ul>
<li>例5：输入值是人员性别，输入形式为单选下拉框，要求输入的内容必须在集合{男,女}中；<ul>
<li>有效等价类：性别＝’男’ 或者 ‘女’</li>
<li>无效等价类1：未选择人员性别</li>
<li>无效等价类2：在浏览器开发工具中将人员性别的属性值更改为’人妖’</li>
</ul>
</li>
</ul>
<p>６、在确知已划分的等价类中各元素在程序处理中的方式不同的情况下，则应再将该等价类划分为更小的等价类。</p>
<ul>
<li>例6：在例2（输入值是人员性别，输入形式为文本框，要求输入的内容必须在集合{男,女}中）的基础上，不同的性别选择将跳转至不同的处理页面<ul>
<li>有效等价类：性别＝’男’ 或者 ‘女’<ul>
<li>有效等价类细分1：性别＝’男’</li>
<li>有效等价类细分2：性别＝’女’</li>
</ul>
</li>
<li>无效等价类：性别＝’人妖’</li>
</ul>
</li>
</ul>
<h2 id="列出等价类表"><a href="#列出等价类表" class="headerlink" title="列出等价类表"></a>列出等价类表</h2><table>
<thead>
<tr>
<th align="center">输入条件</th>
<th align="center">有效等价类</th>
<th align="center">无效等价类</th>
</tr>
</thead>
<tbody><tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody></table>
<h2 id="确定测试用例"><a href="#确定测试用例" class="headerlink" title="确定测试用例"></a>确定测试用例</h2><p>根据已列出的等价类表，按照如下步骤确定测试用例：<br>1）为每个等价类规定一个唯一的编号<br>2）设计一个新的测试用例，使其尽可能多地覆盖尚未覆盖的有效等价类。重复这一步，最后使得所有有效等价类均被测试用例所覆盖。<br>3）设计一个新的测试用例，使其只覆盖一个无效等价类。重复这一步，使所有无效等价类均被覆盖。</p>
<h2 id="Example1"><a href="#Example1" class="headerlink" title="Example1"></a>Example1</h2><blockquote>
<p>某程序具有如下功能：输入3个正数a、b、c，分别作为三边的边长构成三角形，输出这3个数所构成的三角形类型。<br>用等价类划分方法为该程序进行测试用例设计。</p>
</blockquote>
<h3 id="划分等价类-1"><a href="#划分等价类-1" class="headerlink" title="划分等价类"></a>划分等价类</h3><p>分析思路：<br>步骤一、要求输入3个数，且3个数都为正数；参照规则5，划分为一个有效等价类和三个无效等价类。</p>
<ul>
<li>有效等价类（1）：a&gt;0; b&gt;0; c&gt;0;</li>
<li>无效等价类（2）：a&lt;=0</li>
<li>无效等价类（3）：b&lt;=0</li>
<li>无效等价类（4）：c&lt;=0</li>
</ul>
<p>步骤二、在有效等价类（1）的基础上，参照规则6，对该等价类进行细分；考察3个数能否构成三角形，参照规则5，划分为一个有效等价类和三个无效等价类。</p>
<ul>
<li>有效等价类（5）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a</li>
<li>无效等价类（6）：a&gt;0; b&gt;0; c&gt;0; a+b&lt;=c</li>
<li>无效等价类（7）：a&gt;0; b&gt;0; c&gt;0; b+c&lt;=a</li>
<li>无效等价类（8）：a&gt;0; b&gt;0; c&gt;0; a+c&lt;=b</li>
</ul>
<p>步骤三、在有效等价类（5）的基础上，参照规则6，对该等价类进行细分；考察3个数能否构成等边三角形，参照规则2，划分为一个有效等价类和一个无效等价类。</p>
<ul>
<li>有效等价类（9）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a; a=b=c</li>
<li>无效等价类（10）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a; a!=b 或 b!=c 或 c!=a</li>
</ul>
<p>步骤四、在无效等价类（10）的基础上，参照规则6，对该等价类进行细分；考察3个数能否构成等腰三角形，参照规则4，划分为三个有效等价类和一个无效等价类。</p>
<ul>
<li>有效等价类（11）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a; a=b!=c</li>
<li>有效等价类（12）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a; b=c!=a</li>
<li>有效等价类（13）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a; c=a!=b</li>
<li>无效等价类（14）：a&gt;0; b&gt;0; c&gt;0; a+b&gt;c; a+c&gt;b; b+c&gt;a; a!=b; a!=c; b!=c</li>
</ul>
<h3 id="设计测试用例"><a href="#设计测试用例" class="headerlink" title="设计测试用例"></a>设计测试用例</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">[a,b,c]</th>
<th align="center">覆盖等价类</th>
<th align="center">预期输出结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">覆盖有效等价类</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">[6,6,6]</td>
<td align="center">（1）（5）（9）</td>
<td align="center">等边三角形</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">[3,3,5]</td>
<td align="center">（1）（5）（10）（11）</td>
<td align="center">等腰三角形</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">[3,4,4]</td>
<td align="center">（1）（5）（10）（12）</td>
<td align="center">等腰三角形</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">[4,5,4]</td>
<td align="center">（1）（5）（10）（13）</td>
<td align="center">等腰三角形</td>
</tr>
<tr>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">覆盖无效等价类</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">[3,4,5]</td>
<td align="center">（1）（5）（14）</td>
<td align="center">一般三角形</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">[-1,3,2]</td>
<td align="center">（2）</td>
<td align="center">不能构成三角形</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">[3,-1,2]</td>
<td align="center">（3）</td>
<td align="center">不能构成三角形</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">[3,2,-1]</td>
<td align="center">（4）</td>
<td align="center">不能构成三角形</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">[1,2,3]</td>
<td align="center">（1）（6）</td>
<td align="center">不能构成三角形</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">[3,1,2]</td>
<td align="center">（1）（7）</td>
<td align="center">不能构成三角形</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">[1,3,2]</td>
<td align="center">（1）（8）</td>
<td align="center">不能构成三角形</td>
</tr>
</tbody></table>
<h2 id="Example2"><a href="#Example2" class="headerlink" title="Example2"></a>Example2</h2><hr>
<blockquote>
<p>某程序具有如下功能：文本框要求输入日期信息，日期限定在1990年1月~2049年12月，并规定日期由6位数字字符组成，前4位表示年，后2位表示月；程序需对输入的日期有效性进行校验。<br>用等价类划分方法为该程序的“日期检查功能”设计测试用例。</p>
</blockquote>
<h3 id="划分等价类-2"><a href="#划分等价类-2" class="headerlink" title="划分等价类"></a>划分等价类</h3><p>步骤一、要求输入6个数字字符yyyynn；参照规则5，划分为一个有效等价类和三个无效等价类。</p>
<ul>
<li>有效等价类（1）：输入6个数字字符</li>
<li>无效等价类（2）：输入6个字符，存在非数字的情况</li>
<li>无效等价类（3）：输入少于6个字符</li>
<li>无效等价类（4）：输入多于6个字符</li>
</ul>
<p>步骤二、在有效等价类（1）的基础上，参照规则6，对该等价类进行细分；考察6个数是否满足日期格式要求，1990&lt;=yyyy&lt;=2049，01&lt;=nn&lt;=12，参照规则，划分为一个有效等价类和四个无效等价类。</p>
<ul>
<li>有效等价类（5）：日期格式满足要求，1990&lt;=yyyy&lt;=2049，01&lt;=nn&lt;=12</li>
<li>无效等价类（6）：yyyy不满足要求，yyyy&lt;1990</li>
<li>无效等价类（7）：yyyy不满足要求，yyyy&gt;2049</li>
<li>无效等价类（8）：nn不满足要求，nn&lt;01</li>
<li>无效等价类（9）：nn不满足要求，nn&gt;12</li>
</ul>
<h3 id="设计测试用例-1"><a href="#设计测试用例-1" class="headerlink" title="设计测试用例"></a>设计测试用例</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">yyyynn</th>
<th align="center">覆盖等价类</th>
<th align="center">预期输出结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">覆盖有效等价类</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">199307</td>
<td align="center">（1）（5）</td>
<td align="center">日期格式有效</td>
</tr>
<tr>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">覆盖无效等价类</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">19June</td>
<td align="center">（2）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">19Jun</td>
<td align="center">（3）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">19June2</td>
<td align="center">（4）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">198805</td>
<td align="center">（6）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">205005</td>
<td align="center">（7）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">198800</td>
<td align="center">（8）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">199513</td>
<td align="center">（9）</td>
<td align="center">日期格式无效</td>
</tr>
</tbody></table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/WebService-Test-Based-On-HTTP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/WebService-Test-Based-On-HTTP/" class="post-title-link" itemprop="url">基 HTTP 的 WebService 测试方法</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-02-13 00:00:00" itemprop="dateCreated datePublished" datetime="2015-02-13T00:00:00+08:00">2015-02-13</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/WebService/" itemprop="url" rel="index"><span itemprop="name">WebService</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在《基于WSDL或SOAP的WebService测试方法–对原理的思考》一文中写道：</p>
<blockquote>
<p>从通讯协议层面上来看，SOAP报文只是对传输的内容进行了格式封装，具体传输实现还是依赖于其它应用层协议（如HTTP）。因此我们在测试WebService时，完全可以抛开WSDL和SOAP，直接从HTTP协议层面获取请求和响应的内容，然后采用测试工具构造HTTP请求，实现对WebService的调用。</p>
</blockquote>
<p>在本篇文章中，<code>52test.org</code>仍将在测试案例<a href="http://webservice.webxml.com.cn/WebServices/WeatherWebService.asmx" target="_blank" rel="noopener">天气预报WebService服务</a>的基础上，详细介绍如何通过HTTP协议测试WebService。</p>
<h2 id="获取HTTP请求"><a href="#获取HTTP请求" class="headerlink" title="获取HTTP请求"></a>获取HTTP请求</h2><p>在<code>天气预报WebService服务</code>的各个接口介绍页面中，均包含一个测试工具，可对接口进行调用测试。</p>
<p>例如，接口getWeatherbyCityName的测试工具如下图所示。在theCityName参数框内输入城市的名称，点击【调用】按钮，即可实现对getWeatherbyCityName接口的调用，并获得返回结果。</p>
<p><img src="/images/150213_01.png" alt></p>
<p>在WebService的调用过程中，我们无需关注它具体是采用什么样的通讯协议，因为不管是何种通讯协议，具体传输实现还是会依赖于HTTP。因此，我们可以通过HTTP抓包工具对WebService调用过程中的通讯交互数据包进行捕捉。</p>
<p>在这里我们采用Fiddler Web Debugger进行演示。在浏览器中调用接口getWeatherbyCityName的测试工具时，在Fiddler中抓取到对应的HTTP请求，如下图所示。</p>
<p><img src="/images/150213_02.png" alt></p>
<p>从该HTTP请求可以获得如下关键信息：</p>
<ul>
<li>HTTP请求类型为POST，HTTP版本为1.1</li>
<li>请求的URL为：<a href="http://webservice.webxml.com.cn/WebServices/WeatherWebService.asmx/getWeatherbyCityName" target="_blank" rel="noopener">http://webservice.webxml.com.cn/WebServices/WeatherWebService.asmx/getWeatherbyCityName</a></li>
<li>POST的数据包为：theCityName=%E5%B9%BF%E5%B7%9E；POST数据包中对中文进行了URL转码</li>
</ul>
<p>使用获取到的HTTP信息，可构造HTTP请求，从HTTP协议层面对WebService进行调用。</p>
<h2 id="在Fiddler中构造HTTP请求"><a href="#在Fiddler中构造HTTP请求" class="headerlink" title="在Fiddler中构造HTTP请求"></a>在Fiddler中构造HTTP请求</h2><p>在Fiddler中，可使用Composer对HTTP请求进行构造，如下图所示。</p>
<p><img src="/images/150213_03.png" alt></p>
<p>在Request Body中，修改请求参数theCityName为不同的城市（例如，重庆），Execute请求，查看返回结果。</p>
<p><img src="/images/150213_04.png" alt></p>
<h2 id="在LoadRunner中构造HTTP请求"><a href="#在LoadRunner中构造HTTP请求" class="headerlink" title="在LoadRunner中构造HTTP请求"></a>在LoadRunner中构造HTTP请求</h2><p>若要进行性能测试，则需在性能测试工具中构造HTTP请求，再通过多进程或多线程机制实现并发压力测试。</p>
<p>在LoadRunner中，可在Web(HTTP/HTML)虚拟用户协议中，采用web_custom_request函数来构造HTTP请求。</p>
<p>具体的代码实现及回放结果如下图所示。</p>
<p><img src="/images/150213_05.png" alt></p>
<p>虽然在LoadRunner中返回的中文显示为乱码，但是从城市编码（57516）可以看出，脚本执行后返回了正确的结果。</p>
<h2 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h2><p>通过这篇文章可以看出，在通讯协议层面上对应用服务进行测试时，可以采用更底层的协议。当然，由于HTTP协议是基于Socket的，在测试WebService时也可以从Socket协议层面进行测试，但估计没人会那么去做。</p>
<p>至此，我们已经对主流的WebService测试方法完成了总结，相关的文章如下：</p>
<ul>
<li><a href="!--￼0--">测试工程师的自我修养–理解WebService</a></li>
<li><a href="!--￼1--">LoadRunner基于WSDL的WebService测试方法</a></li>
<li><a href="!--￼2--">LoadRunner基于SOAP的WebService测试方法</a></li>
<li><a href="!--￼3--">基于WSDL或SOAP的WebService测试方法–对原理的思考</a></li>
<li><a href="!--￼4--">基于HTTP的WebService测试方法</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/Introspection-on-WebService-Test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/Introspection-on-WebService-Test/" class="post-title-link" itemprop="url">基于WSDL或SOAP的WebService测试方法--对原理的思考</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-02-12 00:00:00" itemprop="dateCreated datePublished" datetime="2015-02-12T00:00:00+08:00">2015-02-12</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/WebService/" itemprop="url" rel="index"><span itemprop="name">WebService</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>截止至今，我们已经总结了两种WebService测试方法，分别对应了两种应用场景：</p>
<ul>
<li>在只获知WSDL的情况下，如何采用LoadRunner测试WebService</li>
<li>在具有SOAP报文的情况下，如何采用LoadRunner测试WebService</li>
</ul>
<p>在文章《LoadRunner基于WSDL的WebService测试方法》和《LoadRunner基于SOAP的WebService测试方法》中，已经详细地描述了两种测试方法的具体实现方式，即使对于一个新接触WebService的测试人员，按照文章中的方法也基本都能完成测试任务。</p>
<p>但是，读到这里你是否会感到困惑：这两种测试方法之间的主要区别在哪儿？两者之间是否存在什么内在联系呢？</p>
<p>没错，虽然从LoadRunner的操作方式（导入WSDL和导入SOAP）与最终生成的封装函数（web_service_call和soap_request）来看，两者完全是两种不同的测试方法，但是从原理层面上讲，他们本质上都是一样的。</p>
<p>别惊讶，我们先来回顾一下WebService的概念。可参考《测试工程师的自我修养–理解WebService》。</p>
<p>在WebService中，涉及到的技术名词主要有包括WSDL和SOAP。其中，WSDL就如同WebService的规格说明书，它详细描述了WebService提供的服务接口，包括每个接口的方法名称、接受的参数类型，以及返回的数据结构。除此之外，WSDL还描述了网络传输协议，即WebService支持以什么协议进行通讯交互。而SOAP作为一种XML编码格式的通讯协议，在WebService中应用得最为广泛，基本上绝大多数WebService都支持SOAP协议，以至于谈到WebService时，会不由自主地联想到SOAP，甚至非常多的人混淆了WSDL和SOAP的概念，常在网上提问两者的区别。</p>
<p>事实上，对于WebService而言，SOAP并不是必须的，我们完全可以采用别的通讯协议来代替它。</p>
<p>现在再回到前面的问题。</p>
<p>在基于WSDL的WebService测试方法中：LoadRunner导入WSDL后，对WSDL进行解析，分析出里面包含的接口以及支持的通讯协议，并以友好的交互界面展示给测试人员。测试人员在界面中选择接口（Operation）和通讯协议（Port Name）后，LoadRunner进行封装，生成了web_service_call函数。</p>
<p>而在基于SOAP的WebService测试方法中：给定的SOAP报文已经限定了特定的接口和输入参数，当然，既然是SOAP报文，采用的通讯协议当然就是SOAP协议，并且在报文中指明了特定的SOAP版本。LoadRunner导入SOAP报文后，经过封装，生成了soap_request函数。</p>
<p>说到这里大家应该比较清楚了，不管是基于WSDL还是基于SOAP，最终无非都是指定WebService接口函数和通讯协议，然后，输入参数，获取响应结果。至于LoadRunner采用了什么样的封装函数，那也只是不同的表现形式而已。</p>
<p>其实，从通讯协议层面上来看，SOAP报文只是对传输的内容进行了格式封装，具体传输实现还是依赖于其它应用层协议（如HTTP）。因此我们在测试WebService时，完全可以抛开WSDL和SOAP，直接从HTTP协议层面获取请求和响应的内容，然后采用测试工具构造HTTP请求，实现对WebService的调用。</p>
<p>在下一篇文章中，<code>52test.org</code>将详细介绍如何通过HTTP协议测试WebService，敬请关注。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/SIPp-IP-Telephone-Server-Performance-Testing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/SIPp-IP-Telephone-Server-Performance-Testing/" class="post-title-link" itemprop="url">使用 SIPp 对基于 SIP 协议的 IP 电话通信服务器进行性能测试</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-05-11 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-11T00:00:00+08:00">2014-05-11</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/性能测试/" itemprop="url" rel="index"><span itemprop="name">性能测试</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景知识介绍"><a href="#背景知识介绍" class="headerlink" title="背景知识介绍"></a>背景知识介绍</h2><h3 id="IP电话"><a href="#IP电话" class="headerlink" title="IP电话"></a>IP电话</h3><p>IP电话是指在IP网络上打电话。所谓“IP网络”就是“使用IP协议的分组交换网”的简称。<br>常见的IP电话有VoIP（Voice over IP），Internet Telephony 和 VON（Voice over Net）。</p>
<h3 id="IP电话网关"><a href="#IP电话网关" class="headerlink" title="IP电话网关"></a>IP电话网关</h3><p>IP电话网关（IP Telepathy Gateway），是公用电话网（即公用电路交换电话网，又称传统电话网或电信网）与IP网络的接口设备，其作用包含两个方面：</p>
<ul>
<li>在电话呼叫阶段和呼叫释放阶段进行电话信令的转换</li>
<li>在通话期间进行话音编码的转换</li>
</ul>
<p>IP电话网关的出现，实现了PC机用户之间的IP电话通话（无需经过IP电话网关），PC机用户与固定电话用户的IP电话通话（仅需经过IP电话网关1次），以及固定电话用户之间的IP电话通话（需要经过IP电话网关2次）。</p>
<h3 id="IP电话所需要的几种应用协议"><a href="#IP电话所需要的几种应用协议" class="headerlink" title="IP电话所需要的几种应用协议"></a>IP电话所需要的几种应用协议</h3><p>在IP电话的通信中，至少需要两种应用协议，即信令协议和传送协议。<br>其中，<strong>信令协议</strong>的作用是帮助主叫者在因特网上找到被叫用户。在公用电话网中，电话交换机根据用户所拨打的号码就能够通过合适的路由找到被叫用户，并在主叫和被叫之间建立一条电路连接。这些都是依靠电话信令（Signaling）实现的。我们听到的振铃音、忙音或一些录音提示，以及打完电话挂机释放连接，都是由电话信令来处理的。现在电话网使用的信令是7号信令SS7。利用IP网络打电话同样也需要IP网络能够识别某种信令。但由于IP电话往往要经过已有的公用电话网，因此IP电话的信令必须在功能上与原有的7号信令相兼容，这样才能使IP网络和公用电话网上的两种信令能够互相转换，从而做到互操作。现有的与信令有关的协议为H.323和SIP，本文只介绍SIP协议。<br>话音分组的<strong>传送协议</strong>，其作用是使用来进行电话通信的话音数据能够以时延敏感属性在因特网中传送。常见的传送协议为RTP。</p>
<h3 id="SIP协议"><a href="#SIP协议" class="headerlink" title="SIP协议"></a>SIP协议</h3><p>SIP协议，即会话发起协议（Session Initiation Protocol），是使用文本方式的客户服务器协议。<br>SIP系统只有两种构件，即用户代理（user agent）和网络服务器（network server）。<br>用户代理包含两个程序，即用户代理客户端UAC（User Agent Client）和用户代理服务器UAS（User Agent Server）；前者用来发起呼叫，后者用来接受呼叫。<br>网络服务器分为代理服务器（proxy server）和重定向服务器（redirect server）。代理服务器接受来自主叫用户的呼叫请求（实际上是来自用户代理客户端UAC的呼叫请求），并将其转发给被叫用户或下一跳代理服务器；若转发给下一跳代理服务器，则下一跳代理服务器再把呼叫请求转发给被叫用户（实际上是转发给用户代理服务器UAS）。重定向服务器不接受呼叫，它通过响应告诉客户下一跳代理服务器的地址，由客户按此地址向下一跳代理服务器重新发送呼叫请求。<br>SIP的会话共有三个阶段：建立会话、通信和终止会话。图1给出了一个简单的SIP会话的例子。其中建立会话阶段和终止会话阶段都是使用SIP协议，而中间的通信阶段是使用如RTP这样的传送实时话音分组的协议。</p>
<p>{: .center}<br><img src="/images/20140511201122_SIP_Simple_Session.png" alt="SIP_Simple_Session"><br>图1 SIP的简单会话过程</p>
<p>在图1中，主叫方（Tesla）先向被叫方（Marconi）发出INVITE报文，这个报文中含有双方的地址信息以及一些其它信息（如通话时话音编码方式等）；被叫方收到请求后，会返回180 Ringing的状态码，并处于振铃状态；若被叫方接受呼叫请求，则返回200 OK的状态码；主叫方再发送ACK报文作为确认（类似于TCP建立连接时的三次握手），然后双方便完成连接，可以进行通话了；通话过程中，双方中的任何一方都可以发送BYE报文以终止会话。如上便是SIP会话的全过程。</p>
<h2 id="SIPp工具介绍"><a href="#SIPp工具介绍" class="headerlink" title="SIPp工具介绍"></a>SIPp工具介绍</h2><h3 id="SIPp软件简介"><a href="#SIPp软件简介" class="headerlink" title="SIPp软件简介"></a>SIPp软件简介</h3><p>如下是SIPp官方网站上关于SIPp的介绍。</p>
<blockquote>
<p>SIPp is a free Open Source test tool / traffic generator for the SIP protocol. It includes a few basic SipStone user agent scenarios (UAC and UAS) and establishes and releases multiple calls with the INVITE and BYE methods. It can also reads custom XML scenario files describing from very simple to complex call flows. It features the dynamic display of statistics about running tests (call rate, round trip delay, and message statistics), periodic CSV statistics dumps, TCP and UDP over multiple sockets or multiplexed with retransmission management and dynamically adjustable call rates.<br>SIPp can be used to test various real SIP equipment like SIP proxies, B2BUAs, SIP media servers, SIP/x gateways, SIP PBX, … It is also very useful to emulate thousands of user agents calling your SIP system.</p>
</blockquote>
<h3 id="SIPp的安装（Windows）"><a href="#SIPp的安装（Windows）" class="headerlink" title="SIPp的安装（Windows）"></a>SIPp的安装（Windows）</h3><p>SIPp几乎可以运行在所有UNIX平台上，HPUX、Tru64、Linux (RedHat, Debian, FreeBSD)和Solaris/SunOS。并且，SIPp已被移植到Windows平台。</p>
<ul>
<li>在Linux/Unix平台上，SIPp采用源代码的形式进行提供，需要通过编译源代码的方式进行安装。</li>
<li>在Windows平台上，SIPp提供了预编译的可执行文件，可以直接进行安装；也可以通过在Windows系统中安装CYGWIN模拟Linux环境，然后通过编译源代码的方式进行安装。</li>
</ul>
<p>通常情况下，在Windows平台中通过预编译可执行文件可以快速完成安装，操作简单且成功率高，但该种方式存在局限性，主要有如下几点：</p>
<ul>
<li>Windows预编译版本的功能存在删减，不支持PCAP（语音）和密码验证功能；</li>
<li>Windows的预编译版本较为滞后，例如当前SIPp的最新版本为3.4，而Windows的最新预编译版本为3.2；</li>
<li>相比于Linux/Unix平台，SIPp在Windows平台上运行不够稳定，特别是并发量较大时可能会出现问题，因此不适宜进行压力测试。</li>
</ul>
<h3 id="SIPp的工作原理"><a href="#SIPp的工作原理" class="headerlink" title="SIPp的工作原理"></a>SIPp的工作原理</h3><p>对于电话而言，每台电话机既是客户端（可拨打电话）也是服务端（可接听电话）。同理，SIPp模拟用户代理，也有两种工作模式：UAC和UAS。</p>
<p>SIPp中具有场景（scenario）的概念，它是一个XML格式的文件，其作用是用来描述SIP协议通讯过程。具体地，UAC和UAS分别对应一个场景文件：uac.xml用于描述客户端的呼叫，uas.xml用于描述服务端的响应。在SIPp工具中，已经内置了许多场景文件，可直接使用；测试人员也可参照场景文件的格式要求，自定义编写场景文件。</p>
<p>另外，SIPp采用了数据与场景分离的设计，从而使工具的使用更加灵活。其中，数据包括IP地址、端口号、电话号码、用户名等内容。通常，测试数据保存在CSV文件中，如data.csv。</p>
<p>SIPp是通过命令行的方式操作调用的。例如，在利用SIPp模拟UAC发起呼叫时，可在cmd窗口中运行如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sipp -sn uac 172.31.89.4:5060 -r 1 -rp 3000 -inf data.csv -p 7098 -i 172.31.89.242 -s 8001 -sf uac_onecall.xml –m 1000 –l 900</span><br></pre></td></tr></table></figure>

<p>可以看出，如果每次都在命令行中输入命令进行运行，效率将十分低下；因此，可以将配置好的命令保存在bat批处理文件中，方便测试时直接调用。</p>
<h3 id="SIPp的常用工作模式"><a href="#SIPp的常用工作模式" class="headerlink" title="SIPp的常用工作模式"></a>SIPp的常用工作模式</h3><p>SIPp具有三种常用工作模式：</p>
<ul>
<li>当SIPp作为UAC时，可向已有电话终端（电话机或运行在电脑上的虚拟终端）发起呼叫；</li>
<li>当SIPp作为UAS时，可接收到现有电话终端（电话机或运行在电脑上的虚拟终端）发起的呼叫；</li>
<li>SIPp还可同时作为UAC和UAS，并使用UAC向UAS发起呼叫，以此来对代理服务器进行测试。</li>
</ul>
<p>图2是对第三种模式的描述。</p>
<p>{: .center}<br><img src="/images/20140511201122_SIPp_Operating_Principle.jpg" alt="SIPp_Operating_Principle"><br>图2 SIPp工作原理</p>
<p>在该种模式下，需先运行服务端UAS，然后再运行客户端UAC。接下来，UAC便参照uac.xml场景文件的描述，发起呼叫；而UAS则参照uas.xml场景文件的描述，对呼叫进行响应；整个通讯过程遵循SIP协议，在本文的1.4节已经进行了介绍。</p>
<h2 id="SIPp的使用"><a href="#SIPp的使用" class="headerlink" title="SIPp的使用"></a>SIPp的使用</h2><h3 id="SIPp的配置文件"><a href="#SIPp的配置文件" class="headerlink" title="SIPp的配置文件"></a>SIPp的配置文件</h3><p>通过本文2.3节的介绍可知，使用SIPp时会涉及到5个文件：uac.xml, uas.xml, data.csv, uac.bat, uas.bat。</p>
<p>其用途简要说明如下：</p>
<ul>
<li>uac.xml：用于描述客户端UAC的SIP信号流程；</li>
<li>uas.xml：用于描述服务端UAS的SIP信号流程；</li>
<li>data.csv：存储数据的文件，方便在uac.xml和uas.xml中引入的相应数据；</li>
<li>uac.bat：存储SIPp命令及参数，便于执行时直接调用，模拟UAC的呼叫；</li>
<li>uas.bat：存储SIPp命令及参数，便于执行时直接调用，模拟UAS的响应。</li>
</ul>
<p>由于uac.xml和uas.xml类似，uac.bat和uas.bat类似，本文只对uac.xml、uac.bat和data.csv三个文件进行讲解。</p>
<h3 id="uac-xml"><a href="#uac-xml" class="headerlink" title="uac.xml"></a>uac.xml</h3><p>SIPp默认自带的uac.xml内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE scenario SYSTEM "sipp.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">scenario</span> <span class="attr">name</span>=<span class="string">"Basic Sipstone UAC"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- In client mode (sipp placing calls), the Call-ID MUST be         --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- generated by sipp. To do so, use [call_id] keyword.              --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span> <span class="attr">retrans</span>=<span class="string">"500"</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      INVITE sip:[service]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: sipp &lt;sip:sipp@[local_ip]:[local_port]&gt;;tag=[call_number]</span><br><span class="line">      To: sut &lt;sip:[service]@[remote_ip]:[remote_port]&gt;</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 1 INVITE</span><br><span class="line">      Contact: sip:sipp@[local_ip]:[local_port]</span><br><span class="line">      Max-Forwards: 70</span><br><span class="line">      Subject: Performance Test</span><br><span class="line">      Content-Type: application/sdp</span><br><span class="line">      Content-Length: [len]</span><br><span class="line"></span><br><span class="line">      v=0</span><br><span class="line">      o=user1 53655765 2353687637 IN IP[local_ip_type] [local_ip]</span><br><span class="line">      s=-</span><br><span class="line">      c=IN IP[media_ip_type] [media_ip]</span><br><span class="line">      t=0 0</span><br><span class="line">      m=audio [media_port] RTP/AVP 0</span><br><span class="line">      a=rtpmap:0 PCMU/8000</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"100"</span> <span class="attr">optional</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"180"</span> <span class="attr">optional</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- By adding rrs="true" (Record Route Sets), the route sets         --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- are saved and used for following messages sent. Useful to test   --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- against stateful SIP proxies/B2BUAs.                             --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"200"</span> <span class="attr">rtd</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Packet lost can be simulated in any send/recv message by         --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- by adding the 'lost = "10"'. Value can be [1-100] percent.       --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      ACK sip:[service]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: sipp &lt;sip:sipp@[local_ip]:[local_port]&gt;;tag=[call_number]</span><br><span class="line">      To: sut &lt;sip:[service]@[remote_ip]:[remote_port]&gt;[peer_tag_param]</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 1 ACK</span><br><span class="line">      Contact: sip:sipp@[local_ip]:[local_port]</span><br><span class="line">      Max-Forwards: 70</span><br><span class="line">      Subject: Performance Test</span><br><span class="line">      Content-Length: 0</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- This delay can be customized by the -d command-line option       --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- or by adding a 'milliseconds = "value"' option here.             --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pause</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- The 'crlf' option inserts a blank line in the statistics report. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span> <span class="attr">retrans</span>=<span class="string">"500"</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      BYE sip:[service]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: sipp &lt;sip:sipp@[local_ip]:[local_port]&gt;;tag=[call_number]</span><br><span class="line">      To: sut &lt;sip:[service]@[remote_ip]:[remote_port]&gt;[peer_tag_param]</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 2 BYE</span><br><span class="line">      Contact: sip:sipp@[local_ip]:[local_port]</span><br><span class="line">      Max-Forwards: 70</span><br><span class="line">      Subject: Performance Test</span><br><span class="line">      Content-Length: 0</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"200"</span> <span class="attr">crlf</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- definition of the response time repartition table (unit is ms)   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ResponseTimeRepartition</span> <span class="attr">value</span>=<span class="string">"10, 20, 30, 40, 50, 100, 150, 200"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- definition of the call length repartition table (unit is ms)     --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CallLengthRepartition</span> <span class="attr">value</span>=<span class="string">"10, 50, 100, 500, 1000, 5000, 10000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">scenario</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如该文件所示，UAC首先发送INVITE请求，按照预期，UAC将依次接收100、180和200状态码，然后UAC再次发送ACK进行确认，从而完成通信连接的建立；最后，UAC发送BYE请求，结束通话，从而断开通信连接。</p>
<h3 id="data-csv"><a href="#data-csv" class="headerlink" title="data.csv"></a>data.csv</h3><p>在data.csv文件中，第一行描述数据的读取方式，如顺序读取（SEQUENTIAL）、随机读取（RANDOM），或者自定义方式（USER）。<br>从第二行开始，每行描述一次呼叫时使用的数据；如果每次呼叫时调用的参数有多个，那么就可用分号（”;”）进行分离，并可在XML文件中进行调用，每行的数据从左到右依次为[field0], [field1], …。</p>
<p>csv文件的编写示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SEQUENTIAL</span><br><span class="line">#注释将被忽略</span><br><span class="line">Sarah;sipphone32</span><br><span class="line">Bob;sipphone12</span><br><span class="line">#This line too</span><br><span class="line">Fred;sipphone94</span><br></pre></td></tr></table></figure>

<p>XML调用CSV的具体方式如图3所示。</p>
<p>{: .center}<br><img src="/images/20140511201122_XML_Invoke_CSV.jpg" alt="XML_Invoke_CSV"><br>图3 XML调用CSV的原理</p>
<h3 id="uac-bat"><a href="#uac-bat" class="headerlink" title="uac.bat"></a>uac.bat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sipp -sn uac 172.31.89.4:5060 -r 1 -rp 3000 -inf data.csv -p 7098 -i 172.31.89.242 -s 8001 -sf uac_onecall.xml –m 1000 –l 900</span><br></pre></td></tr></table></figure>

<p>各个参数说明：</p>
<ul>
<li>172.31.89.4:5060：远端地址和端口（在xml脚本中用[remote_ip]，[remote_port]引用）</li>
<li>-r 1 -rp 3000：每三秒钟（3000毫秒）发起一个呼叫</li>
<li>-inf data.csv：引入数据配置文件</li>
<li>-p 7098：本地端口（在xml脚本中用[local_port]引用）</li>
<li>-i 172.31.89.242：本地地址（在xml脚本中用[local_ip]引用）</li>
<li>-s 8001：被叫号码（在xml脚本中用[service]引用）</li>
<li>-sf uac_onecall.xml：引用xml脚本文件，根据需要模拟的呼叫流程编写</li>
<li>-sn uac :执行默认的uac流程，如需执行自己编写的流程文件，命令中应不含此参数</li>
<li>-m 1000:发送1000次呼叫后停止并退出。</li>
<li>-l 900 :最大同时保持呼叫量，默认值为3*caps值呼叫时长，当因种种原因导致现存呼叫总数达到此值时，SIPp将停止产生新的呼叫，等待现存呼叫总数低于此值时才继续产生呼叫。</li>
<li>-trace_err跟踪所有错误消息，并把错误消息保存到文件场景文件描述的 {fileName}_{pid}_errors.log 文件中</li>
<li>-trace_screen 当程序结束时候打印统计信息并弹出屏幕（如果在后台运行的话）</li>
</ul>
<h2 id="使用SIPp对基于SIP协议的网络电话进行性能测试"><a href="#使用SIPp对基于SIP协议的网络电话进行性能测试" class="headerlink" title="使用SIPp对基于SIP协议的网络电话进行性能测试"></a>使用SIPp对基于SIP协议的网络电话进行性能测试</h2><h3 id="测试内容"><a href="#测试内容" class="headerlink" title="测试内容"></a>测试内容</h3><ul>
<li>测试某通信服务器在400组并发呼叫过程中的CPU负载峰值和内存占用率。</li>
</ul>
<h3 id="测试场景分析"><a href="#测试场景分析" class="headerlink" title="测试场景分析"></a>测试场景分析</h3><p>呼叫发起端：湖北省公安厅的两台测试机，每台测试机模拟出等量的电话终端，向十堰市公安局的物理电话机发起呼叫。<br>电话接收端：十堰市公安局的400台物理电话机。<br>网络环境：湖北省公安信息网。</p>
<p>测试环境的网络拓扑图如图4所示。</p>
<p>{: .center}<br><img src="/images/20140511201122_Network_Topology_Map.gif" alt="Network_Topology_Map"><br>图4 被测系统的网络拓扑图</p>
<h3 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h3><p>利用SIPp测试工具模拟电话终端，向物理电话机终端发起呼叫，保持呼叫16秒后，SIPp终止呼叫。<br>在测试过程中，通过命令的方式监控并记录通信服务器的CPU负载峰值和内存占用率。</p>
<h3 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h3><p>（1）配置SIPp测试工具：在湖北省公安厅的两台测试机上分别配置SIPp的场景文件（uacTest.xml，详见附录），数据文件（CallNumber.csv，详见附录）和测试控制文件（test.bat，详见附录）。<br>（2）开启通信服务器的资源监控：远程登录至十堰市公安局网络电话通信服务器，执行资源监控命令，开启对通信服务器CPU负载和内存的监控。<br>（3）执行测试：在湖北省公安厅的两台测试机上同时执行SIPp控制文件（bat文件）。<br>（4）获取测试结果：测试完毕后，导出被测通信服务器的资源监控结果，提取出并发测试期间中的资源监控结果。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>电子工业出版社 计算机网络（第5版）谢希仁 编著。</li>
<li><a href="http://sipp.sourceforge.net/" target="_blank" rel="noopener">http://sipp.sourceforge.net/</a></li>
</ul>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>test.bat</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sipp -sf uac.xml -inf CallNumber.csv -i 10.XX.XX.151 -p 5061 -s 96018702 -m 1 -r 1 10.XX.XX.114:5060 -trace_err</span><br></pre></td></tr></table></figure>

<p>uacTest.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE scenario SYSTEM "sipp.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">scenario</span> <span class="attr">name</span>=<span class="string">"Basic Sipstone UAC"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- In client mode (sipp placing calls), the Call-ID MUST be         --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- generated by sipp. To do so, use [call_id] keyword.              --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span> <span class="attr">retrans</span>=<span class="string">"500"</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      INVITE sip:[field0]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: "[service]" &lt;sip:[service]@[remote_ip]&gt;;tag=[call_number]</span><br><span class="line">      To: "[field0]" &lt;sip:[field0]@[remote_ip]&gt;</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 1 INVITE</span><br><span class="line">      Contact: sip:[service]@[local_ip]:[local_port]</span><br><span class="line">      Max-Forwards: 70</span><br><span class="line">      Subject: Performance Test</span><br><span class="line">      Content-Type: application/sdp</span><br><span class="line">      Content-Length: [len]</span><br><span class="line"></span><br><span class="line">      v=0</span><br><span class="line">      o=- 1 2 IN IP[local_ip_type] [local_ip]</span><br><span class="line">      s=-</span><br><span class="line">      c=IN IP[media_ip_type] [media_ip]</span><br><span class="line">      t=0 0</span><br><span class="line">      m=audio [media_port] RTP/AVP 0 8 18 101</span><br><span class="line">      a=rtpmap:18 G729/8000</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"100"</span> <span class="attr">optional</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"180"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Set Ring Time   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pause</span> <span class="attr">milliseconds</span>=<span class="string">"8000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Abort Call   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span> <span class="attr">retrans</span>=<span class="string">"500"</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      CANCEL sip:[field0]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: "[service]" &lt;sip:[service]@[remote_ip]&gt;;tag=[call_number]</span><br><span class="line">      To: "[field0]" &lt;sip:[field0]@[remote_ip]&gt;</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 1 CANCEL</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- By adding rrs="true" (Record Route Sets), the route sets         --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- are saved and used for following messages sent. Useful to test   --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- against stateful SIP proxies/B2BUAs.                             --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"200"</span> <span class="attr">rtd</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Packet lost can be simulated in any send/recv message by         --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- by adding the 'lost = "10"'. Value can be [1-100] percent.       --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      ACK sip:[service]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: sipp &lt;sip:sipp@[local_ip]:[local_port]&gt;;tag=[call_number]</span><br><span class="line">      To: sut &lt;sip:[service]@[remote_ip]:[remote_port]&gt;[peer_tag_param]</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 1 ACK</span><br><span class="line">      Contact: sip:sipp@[local_ip]:[local_port]</span><br><span class="line">      Max-Forwards: 70</span><br><span class="line">      Subject: Performance Test</span><br><span class="line">      Content-Length: 0</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- This delay can be customized by the -d command-line option       --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- or by adding a 'milliseconds = "value"' option here.             --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pause</span> <span class="attr">milliseconds</span>=<span class="string">"8000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- The 'crlf' option inserts a blank line in the statistics report. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">send</span> <span class="attr">retrans</span>=<span class="string">"500"</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line"></span><br><span class="line">      BYE sip:[service]@[remote_ip]:[remote_port] SIP/2.0</span><br><span class="line">      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]</span><br><span class="line">      From: sipp &lt;sip:sipp@[local_ip]:[local_port]&gt;;tag=[call_number]</span><br><span class="line">      To: sut &lt;sip:[service]@[remote_ip]:[remote_port]&gt;[peer_tag_param]</span><br><span class="line">      Call-ID: [call_id]</span><br><span class="line">      CSeq: 2 BYE</span><br><span class="line">      Contact: sip:sipp@[local_ip]:[local_port]</span><br><span class="line">      Max-Forwards: 70</span><br><span class="line">      Subject: Performance Test</span><br><span class="line">      Content-Length: 0</span><br><span class="line"></span><br><span class="line">    ]]&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">send</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">recv</span> <span class="attr">response</span>=<span class="string">"200"</span> <span class="attr">crlf</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">recv</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- definition of the response time repartition table (unit is ms)   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ResponseTimeRepartition</span> <span class="attr">value</span>=<span class="string">"10, 20, 30, 40, 50, 100, 150, 200"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- definition of the call length repartition table (unit is ms)     --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CallLengthRepartition</span> <span class="attr">value</span>=<span class="string">"10, 50, 100, 500, 1000, 5000, 10000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">scenario</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CallNumber.csv</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SEQUENTIAL</span><br><span class="line">96038000;</span><br><span class="line">96038001;</span><br><span class="line">96038002;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/loadrunner-get-system-time/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/loadrunner-get-system-time/" class="post-title-link" itemprop="url">LoadRunner 中获取当前系统时间</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-10-28 00:00:00" itemprop="dateCreated datePublished" datetime="2013-10-28T00:00:00+08:00">2013-10-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/性能测试/" itemprop="url" rel="index"><span itemprop="name">性能测试</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在测试场景中，常会遇到需要提交系统时间的情况。本文对使用LoadRunner获取系统时间的几种方法进行探讨。</p>
<p>常用的方法有如下四种：</p>
<ul>
<li>方法一：使用LR的参数化功能</li>
<li>方法二：使用LR函数lr_save_datetime()</li>
<li>方法三：使用C语言标准函数库中的time()和ctime()</li>
<li>方法四：使用C语言的tm结构，把时间分解成若干元素，再根据需求进行重组</li>
</ul>
<h2 id="方法一：使用LR的参数化功能"><a href="#方法一：使用LR的参数化功能" class="headerlink" title="方法一：使用LR的参数化功能"></a>方法一：使用LR的参数化功能</h2><p>操作步骤：</p>
<p>1、在Parameter List窗口中新建一个参数localtime_now，Parameter type选择为【Date/Time】<br>2、设置Date/Time format，具体格式可参照帮助手册，例如%Y-%m-%d %H:%M:%S对应的是2013-10-28 16:43:06<br>3、在脚本中，利用函数lr_eval_string将参数localtime_now转换为变量tt_1<br>4、在脚本中引用变量tt_1</p>
<p>对应的脚本如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *tt_1;</span><br><span class="line">tt_1 = lr_eval_string(<span class="string">"&#123;localtime_now&#125;"</span>);</span><br><span class="line">lr_message(<span class="string">"系统当前的时间为：%s"</span>, tt_1);</span><br></pre></td></tr></table></figure>

<p>运行结果：<br>系统当前的时间为：2013-10-28 16:43:06</p>
<h2 id="方法二：使用LR函数lr-save-datetime"><a href="#方法二：使用LR函数lr-save-datetime" class="headerlink" title="方法二：使用LR函数lr_save_datetime()"></a>方法二：使用LR函数lr_save_datetime()</h2><p>在LoadRunner中，函数lr_save_datetime可以将当前时间赋值给指定参数，并可在赋值时选择时间样式。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *tt_2;</span><br><span class="line"><span class="comment">//获得当前系统时间，并根据设置的格式将当前时间赋值给 times</span></span><br><span class="line">lr_save_datetime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>, DATE_NOW+TIME_NOW, <span class="string">"localtime_2"</span>);</span><br><span class="line">tt_2 = lr_eval_string(<span class="string">"&#123;localtime_2&#125;"</span>);</span><br><span class="line">lr_message(<span class="string">"系统当前的时间为：%s"</span>, tt_2);</span><br></pre></td></tr></table></figure>

<p>运行结果：<br>系统当前的时间为：2013-10-28 17:43:16</p>
<h2 id="方法三：使用C语言标准函数库中的time-和ctime"><a href="#方法三：使用C语言标准函数库中的time-和ctime" class="headerlink" title="方法三：使用C语言标准函数库中的time()和ctime()"></a>方法三：使用C语言标准函数库中的time()和ctime()</h2><p>对应的脚本如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> tt_3;</span><br><span class="line">time(&amp;tt_3);</span><br><span class="line">lr_message(<span class="string">"系统当前的时间为：%s"</span>, ctime(&amp;tt_3));</span><br></pre></td></tr></table></figure>

<p>运行结果：<br>系统当前的时间为：Mon Oct 28 17:43:16 2013</p>
<h2 id="方法四：tm结构分解"><a href="#方法四：tm结构分解" class="headerlink" title="方法四：tm结构分解"></a>方法四：tm结构分解</h2><p>说明：tm结构即是一个结构体，将时间分解为9个部分，将时间的各个部分赋值给不同的变量，然后根据实际需求，将各个部分进行重组后使用。</p>
<p>对应的脚本如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Action()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> second;   <span class="comment">//取得当前秒数(在分钟后)；取值区间为[0,59]</span></span><br><span class="line">        <span class="keyword">int</span> minute;   <span class="comment">//取得当前分钟数(在小时后)；取值区间为[0,59]</span></span><br><span class="line">        <span class="keyword">int</span> hour;     <span class="comment">//取得当前小时数(从凌晨0点开始)；取值区间为[0,23]</span></span><br><span class="line">        <span class="keyword">int</span> day;      <span class="comment">//取得当前天数(从上月结束开始)；取值区间为[1,31]</span></span><br><span class="line">        <span class="keyword">int</span> month;    <span class="comment">//取得当前月份数(从1月开始)；取值区间为[0,11]</span></span><br><span class="line">        <span class="keyword">int</span> year;     <span class="comment">//取得当前年份数(从1900年开始)</span></span><br><span class="line">        <span class="keyword">int</span> weekday;  <span class="comment">//取得当前日期数(为了获取星期几，从上个星期日开始)；取值区间为[0,6]</span></span><br><span class="line">        <span class="keyword">int</span> yearday;  <span class="comment">//取得当前年份天数(从1月1日开始)；取值区间为[0,365]</span></span><br><span class="line">        <span class="keyword">int</span> daylight; <span class="comment">//取得当前夏令时标识符，实行夏令时的时候，daylight取得一个正数</span></span><br><span class="line">        <span class="comment">//不实行夏令时的进候，daylight为0；</span></span><br><span class="line">        <span class="comment">//不了解情况时，daylight为负数</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> timenow;    <span class="comment">//定义保存时间的变量</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">now</span>;</span>  <span class="comment">//定义结构指针</span></span><br><span class="line">    <span class="keyword">int</span> year, month, day, weekday, hour, minute, second;</span><br><span class="line">    <span class="keyword">char</span> *week;</span><br><span class="line">    time(&amp;timenow);  <span class="comment">//获取当前时间</span></span><br><span class="line">    now = (struct tm *)localtime(&amp;timenow);  <span class="comment">//把当前时间的结构指针赋值给now</span></span><br><span class="line">    year = now-&gt;year;</span><br><span class="line">    month = now-&gt;month;</span><br><span class="line">    day = now-&gt;day;</span><br><span class="line">    hour = now-&gt;hour;   <span class="comment">//获取hour值</span></span><br><span class="line">    minute = now-&gt;minute; <span class="comment">//获取minute值</span></span><br><span class="line">    second = now-&gt;second; <span class="comment">//获取second值</span></span><br><span class="line">    weekday = now-&gt;weekday;<span class="comment">//获取week值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(weekday)<span class="comment">//判断得到中文的星期</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:week =<span class="string">"星期一"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:week =<span class="string">"星期二"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:week =<span class="string">"星期三"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:week =<span class="string">"星期四"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:week =<span class="string">"星期五"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:week =<span class="string">"星期六"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:week =<span class="string">"星期日"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    lr_message(<span class="string">"使用tm结构获取的当前时间为：%d-%d-%d %s %d:%d:%d"</span>,year,month,day,week,hour,minute,second);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：<br>使用tm结构获取的当前时间为：113-9-28 星期一 17:43:16</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/Using-DuoShuo-in-Pelican/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/Using-DuoShuo-in-Pelican/" class="post-title-link" itemprop="url">在Pelican中使用多说评论系统</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-10-05 00:00:00" itemprop="dateCreated datePublished" datetime="2013-10-05T00:00:00+08:00">2013-10-05</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/4-ToolsNotes/" itemprop="url" rel="index"><span itemprop="name">4. ToolsNotes</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/4-ToolsNotes/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>Pelican默认采用的是Disqus评论系统，但由于Disqus附带的Facebook和Twitter社交功能在国内无法使用，因此我们更希望使用一些国内的SNS平台，比如QQ，新浪微博，豆瓣，人人等。在国产的评论系统中，使用较多的有<a href="http://duoshuo.com" target="_blank" rel="noopener">多说</a>、<a href="http://www.uyan.cc/" target="_blank" rel="noopener">有言</a>等，本文将介绍如何在Pelican博客系统中采用多说评论系统。</p>
<h2 id="获取多说代码"><a href="#获取多说代码" class="headerlink" title="获取多说代码"></a>获取多说代码</h2><p>在<a href="http://duoshuo.com" target="_blank" rel="noopener">多说首页</a>点击【我要安装】，进入创建站点界面；完成站点信息填写后，点击【创建】按钮，即可获得多说代码，大致如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Duoshuo Comment BEGIN --&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ds-thread"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"><span class="keyword">var</span> duoshuoQuery = &#123;<span class="attr">short_name</span>:<span class="string">"leolee"</span>&#125;;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ds = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">        ds.type = <span class="string">'text/javascript'</span>;ds.async = <span class="literal">true</span>;</span><br><span class="line">        ds.src = <span class="string">'http://static.duoshuo.com/embed.js'</span>;</span><br><span class="line">        ds.charset = <span class="string">'UTF-8'</span>;</span><br><span class="line">        (<span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>]</span><br><span class="line">        || <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>]).appendChild(ds);</span><br><span class="line">    &#125;)();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;!-- Duoshuo Comment END --&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，short_name即是注册的多说域名。</p>
<h2 id="修改模板系统"><a href="#修改模板系统" class="headerlink" title="修改模板系统"></a>修改模板系统</h2><p>获得多说代码后，在博客正文末尾对其进行引用，便可使用多说的评论功能。<br>由于我们采用的是模板，因此只需要在article模板中添加对多说代码的引用，便可以一劳永逸。<br>针对Pelican的模板系统，需要修改如下几个地方。</p>
<p><strong>在 pelicanconf.py 中开启多说评论功能</strong></p>
<p>模仿Pelican默认的DISQUS，在配置文件pelicanconf.py中添加如下代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DUOSHUO_SITENAME = <span class="string">"leolee"</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，DUOSHUO_SITENAME需要全部字母大写，因为只有这样Pelican才会将其作为全局变量，供其它文件引用。</p>
<p><strong>添加 DuoShuo_Script.html</strong></p>
<p>将获取得到的多说代码保存至单个文件中，方便在其它文件中对其进行引用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> DUOSHUO_SITENAME %&#125;</span><br><span class="line">&lt;!-- Duoshuo Comment BEGIN --&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ds-thread"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"><span class="keyword">var</span> duoshuoQuery = &#123;<span class="attr">short_name</span>:<span class="string">"&#123;&#123; DUOSHUO_SITENAME &#125;&#125;"</span>&#125;;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    ds.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">    ds.async = <span class="literal">true</span>;</span><br><span class="line">    ds.src = <span class="string">'http://static.duoshuo.com/embed.js'</span>;</span><br><span class="line">    ds.charset = <span class="string">'UTF-8'</span>;</span><br><span class="line">    (<span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>]</span><br><span class="line">        || <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>]).appendChild(ds);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;!-- Duoshuo Comment END --&gt;</span></span><br><span class="line"><span class="regexp">&#123;% endif %&#125;</span></span><br></pre></td></tr></table></figure>

<p>在该文件中，添加了一个if语句，即只有在pelicanconf.py中对DUOSHUO_SITENAME进行设置后才开启多说评论功能。</p>
<p><strong>添加 DuoShuo_thread.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">Please enable JavaScript to view the comments powered by <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://duoshuo.com/"</span>&gt;</span>DuoShuo<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.</span><br><span class="line"><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加这个文件的作用是，当浏览器禁用Javascript后，用户无法看见评论框，而这个代码便是对用户进行提示。</p>
<p><strong>修改 article.html</strong></p>
<p>由于评论功能总是出现在文章末尾，因此应该将评论功能模块放在文章模版末尾，即对article.html进行修改，修改内容如下所示。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125;</span><br><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% block title %&#125;&#123;&#123; article.title|striptags &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">"hentry"</span> <span class="attr">role</span>=<span class="string">"article"</span>&gt;</span></span><br><span class="line">    &#123;% include '_includes/article.html' %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">      &#123;% include '_includes/article_infos.html' %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  &#123;% if DUOSHUO_SITENAME and SITEURL and article.status != "draft" %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comments<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"DuoShuoComment"</span> <span class="attr">aria-live</span>=<span class="string">"polite"</span>&gt;</span></span><br><span class="line">      &#123;% include '_includes/DuoShuo_Script.html' %&#125;</span><br><span class="line">      &#123;% include '_includes/DuoShuo_thread.html' %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure>

<p>通过以上修改，便可在Pelican博客系统中使用多说评论系统。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/html-character-entity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/html-character-entity/" class="post-title-link" itemprop="url">HTML 字符实体(Character Entity)</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-10-04 00:00:00" itemprop="dateCreated datePublished" datetime="2013-10-04T00:00:00+08:00">2013-10-04</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-Programming/" itemprop="url" rel="index"><span itemprop="name">2. Programming</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-Programming/HTML/" itemprop="url" rel="index"><span itemprop="name">HTML</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="字符实体的由来"><a href="#字符实体的由来" class="headerlink" title="字符实体的由来"></a>字符实体的由来</h2><p>在HTML源文件中，有些字符（如&lt;，&gt;，&amp;等）作为特殊字符不能直接使用，如果直接使用的话HTML将不能被正确解析。但如果HTML内容中需要展示这些特殊字符时该怎么处理呢？这就需要使用转义字符串来对其进行转义。</p>
<p>转义字符串（Escape Sequence）也称字符实体(Character Entity)。在HTML中，定义转义字符串的原因有两个：</p>
<ul>
<li>第一个原因：像“&lt;”和“&gt;”这类符号已经用来表示HTML标签，因此就不能直接当作文本中的符号来使用。为了在HTML文档中使用这些符号，就需要定义它的转义字符串。当解释程序遇到这类字符串时就把它解释为真实的字符。在输入转义字符串时，要严格遵守字母大小写的规则。</li>
<li>第二个原因：有些字符在ASCII字符集中没有定义，因此需要使用转义字符串来表示。</li>
</ul>
<h2 id="转义字符串的组成"><a href="#转义字符串的组成" class="headerlink" title="转义字符串的组成"></a>转义字符串的组成</h2><p>转义字符串（Escape Sequence），即字符实体（Character Entity）分成三部分：</p>
<ul>
<li>第一部分是一个&amp;符号，英文叫ampersand；</li>
<li>第二部分是字符实体名称（character entity names）或者是#加上实体编号；</li>
<li>第三部分是一个分号。</li>
</ul>
<p>对于实体编号，采用的是字符的Unicode编码序号，并且可以采用其对应的十进制编码或者十六进制编码进行表示，具体形式为<code>#nnnn</code>或<code>#xhhhh</code>。</p>
<p>例如，要显示小于号（&lt;），如果采用字符实体名称进行表示，就可以写成<code>&amp;lt;</code>；如果采用字符实体编号的形式，由于其Unicode编码为60（对应16进制为x3c），因此可以写成<code>&amp;#60;</code>或者<code>&amp;#x3c;</code>。</p>
<p>同一个符号，可以用“实体名称”和“实体编号”两种方式进行表示，“实体名称”的优势在于便于记忆，但不能保证所有的浏览器都能顺利识别它；而“实体编号”，各种浏览器都能处理，其劣势在于不便于记忆。</p>
<p>提示：实体名称（Entity）是区分大小写的。</p>
<p>如何显示空格？<br>通常情况下，HTML会自动截去多余的空格，多个空格都将被看做一个空格。为了在网页中增加空格，可以使用<code>&amp;nbsp;</code>表示空格。</p>
<h2 id="HTML-Encode-amp-Decode"><a href="#HTML-Encode-amp-Decode" class="headerlink" title="HTML Encode &amp; Decode"></a>HTML Encode &amp; Decode</h2><p>对于HTML字符实体的Encode和Decode，即是对字符（character）和其对应的字符实体（Character Entity）进行相互转换。</p>
<p>HTML Encode: 字符(Character) =&gt; 字符实体(Character Entity)<br>HTML Decode: 字符实体(Character Entity) =&gt; 字符(Character)</p>
<p>例如，对于汉字“测试”，由于其Unicode编码为<code>\u6D4B\u8BD5</code>（对应的十进制为<code>27979 35797</code>），因此Encode后得到<code>&amp;#27979;&amp;#35797;</code>；反向地，对<code>&amp;#27979;&amp;#35797;</code>进行Decode后便得到“测试”。当然，对<code>&amp;#x6D4B;&amp;#x8BD5;</code>进行Decode同样可以得到“测试”。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/Create-Blog-with-Pelican-and-GitCafe-Pages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/Create-Blog-with-Pelican-and-GitCafe-Pages/" class="post-title-link" itemprop="url">使用 Pelican + GitCafe Pages 创建 Blog</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-10-03 00:00:00" itemprop="dateCreated datePublished" datetime="2013-10-03T00:00:00+08:00">2013-10-03</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/4-ToolsNotes/" itemprop="url" rel="index"><span itemprop="name">4. ToolsNotes</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/4-ToolsNotes/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="博客系统的技术实现"><a href="#博客系统的技术实现" class="headerlink" title="博客系统的技术实现"></a>博客系统的技术实现</h2><p>博客系统采用 Pelican + GitCafe Pages 的技术架构。</p>
<p>其中，Pelican是一个由Python开发的用于生成静态页面的程序，可以将markdown等格式的文本生成模版格式化的html静态页面；而GitCafe提供的Pages服务可以通过项目的形式对Pelican生成的html文件进行托管，并可通过域名绑定的形式实现独立域名。</p>
<p>这种实现方式与 Jekyll + Github Pages 的实现方式大致相同，差别在于不同的静态页面生成系统和不同的托管平台。而为什么选择GitCafe而非GitHub，是因为GitHub服务器在国外，访问速度较慢，且存在偶尔无法访问的情况。</p>
<h2 id="博客系统的初始化"><a href="#博客系统的初始化" class="headerlink" title="博客系统的初始化"></a>博客系统的初始化</h2><p>创建 Blog 目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir 52test.org</span><br><span class="line">cd 52test.org</span><br></pre></td></tr></table></figure>

<p>初始化 Blog</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pelican-quickstart</span><br></pre></td></tr></table></figure>

<p>根据提示一步步输入相应的配置项，完成配置后在Blog目录下会生成配置文件pelicanconf.py。但通过pelican-quickstart配置的选项较少，更多的配置选项可以参照Pelican官方网站中的教程对pelicanconf.py进行编辑。</p>
<h2 id="配置GitCafe"><a href="#配置GitCafe" class="headerlink" title="配置GitCafe"></a>配置GitCafe</h2><p>在使用GitCafe之前，需要对电脑的Git客户端进行配置，使电脑与远程GitCafe服务器完成认证。<br>通常地，我们采用SSH Key认证方式，这需要我们在使用GitCafe前须先建创自已的SSH key。</p>
<p><strong>进入SSH目录</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh</span><br></pre></td></tr></table></figure>

<p>如果还没有 ~/.ssh 目录的话，请先手工创建一个 <code>mkdir ~/.ssh</code></p>
<p><strong>生成新的SSH秘钥</strong></p>
<p>输入下面的代码，将命令中的 <a href="mailto:YOUR_EMAIL@YOUREMAIL.COM" target="_blank" rel="noopener">YOUR_EMAIL@YOUREMAIL.COM</a> 改为你的Email地址，就可以生成新的key文件。当需要输入文件名的时候，点击回车键，即采用默认设置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"YOUR_EMAIL@YOUREMAIL.COM"</span></span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/your_user_directory/.ssh/id_rsa):&lt;回车就好&gt;</span><br></pre></td></tr></table></figure>

<p>然后系统会要输入加密串（Passphrase）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enter passphrase (empty for no passphrase):&lt;输入加密串&gt;</span><br><span class="line">Enter same passphrase again:&lt;再次输入加密串&gt;</span><br></pre></td></tr></table></figure>

<p>最后看到如下的界面，即表示ssh key成功完成设置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Your identification has been saved in /c/Users/your_user_directory/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /c/Users/your_user_directory/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">15:81:d2:7a:c6:6c:0f:ec:b0:b6:d4:18:b8:d1:41:48 YOUR_EMAIL@YOUREMAIL.COM</span><br></pre></td></tr></table></figure>

<p>SSH 秘钥生成结束后，可以在用户目录 (~/.ssh/) 下看到私钥 id_rsa 和公钥 id_rsa.pub 这两个文件，请妥善保管这两个文件。</p>
<p><strong>添加 SSH 公钥到 GitCafe</strong></p>
<p>用文本工具打开公钥文件 ~/.ssh/id_rsa.pub ，复制里面的所有内容到剪贴板。<br>进入 GitCafe-&gt;【账户设置】-&gt;【SSH 公钥管理】设置项，点击【添加新公钥】按钮，在Title文本框中输入标题，在Key文本框粘贴刚才复制的公钥字符串，输入GitCafe账户密码后按【保存】按钮完成操作。</p>
<p><strong>测试连接</strong></p>
<p>以上步骤完成后，就可以通过以下命令来测试是否可以连接 GitCafe 服务器了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@gitcafe.com</span><br></pre></td></tr></table></figure>

<p>如果是第一次连接的话，会出现以下警告，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The authenticity of host 'gitcafe.com (50.116.2.223)' can't be established.</span><br><span class="line"><span class="meta">#</span><span class="bash">RSA key fingerprint is 84:9e:c9:8e:7f:36:28:08:7e:13:bf:43:12:74:11:4e.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Are you sure you want to <span class="built_in">continue</span> connecting (yes/no)?</span></span><br></pre></td></tr></table></figure>

<p>正常情况下，显示的RSA key fingerprint应该与GitCafe提供的公钥一致，即84:9e:c9:8e:7f:36:28:08:7e:13:bf:43:12:74:11:4e。</p>
<p>如果没有问题，输入yes按回车就可以了，中间会提示输入 passphrase 口令。</p>
<p>最后，如果连接成功的话，会出现以下信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi USERNAME! You've successfully authenticated, but GitCafe does not provide shell access.</span><br></pre></td></tr></table></figure>

<p>测试通过后，就可以通过Git客户端向GitCafe服务器上传博客内容了。</p>
<h2 id="撰写文章"><a href="#撰写文章" class="headerlink" title="撰写文章"></a>撰写文章</h2><p>在 content 目录下用 Markdown 语法来写一篇文章，格式大致如下所示，文件保存后缀为<code>.md</code>。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Title: My First Blog #标题</span><br><span class="line">Date: 2013-10-05 #日期</span><br><span class="line">Tags: test, blog #标签</span><br><span class="line">Slug: my-first-post #URL</span><br><span class="line"></span><br><span class="line">文章内容</span><br></pre></td></tr></table></figure>

<h2 id="生成html静态页面"><a href="#生成html静态页面" class="headerlink" title="生成html静态页面"></a>生成html静态页面</h2><p>创建输出目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir leolee</span><br></pre></td></tr></table></figure>

<p>生成页面</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pelican -s pelicanconf.py content -o leolee</span><br></pre></td></tr></table></figure>

<h2 id="上传到-GitCafe"><a href="#上传到-GitCafe" class="headerlink" title="上传到 GitCafe"></a>上传到 GitCafe</h2><p>先到 GitCafe 上创建一个与用户名相同的项目，例如GitCafe帐号名称为leolee，则创建一个名为leolee的项目。</p>
<p>进入静态页面输出目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd leolee</span><br></pre></td></tr></table></figure>

<p>初始化 git 仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>创建一个gitcafe-pages的分支，并切换到该分支</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b gitcafe-pages</span><br></pre></td></tr></table></figure>

<p>添加所有文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>

<p>提交</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m "init"</span><br></pre></td></tr></table></figure>

<p>添加远程仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin git@gitcafe.com:leolee/leolee.git</span><br></pre></td></tr></table></figure>

<p>push 到 GitCafe 仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin gitcafe-pages</span><br></pre></td></tr></table></figure>

<p>完成<br>push 完成以后就可以在访问 GitCafe Pages 地址了。 <a href="http://leolee.gitcafe.com" target="_blank" rel="noopener">http://leolee.gitcafe.com</a></p>
<p>注：不要用 make html 来构建 Blog ，它会删除输出目录后重新生成 Blog ，这意味着会删除 .git 库。</p>
<h2 id="更新博客"><a href="#更新博客" class="headerlink" title="更新博客"></a>更新博客</h2><p>为了方便更新博客，可以创建了一个shell脚本，放置在Blog根目录下。在此创建的脚本名称为publish.sh，其内容如下所示。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pelican -s pelicanconf.py content -o leolee</span><br><span class="line">cd leolee</span><br><span class="line">git add .</span><br><span class="line">git commit -m "Update"</span><br><span class="line">git push</span><br><span class="line">cd ../</span><br></pre></td></tr></table></figure>

<p>更新博客时，只需要将新增博客的markdown文件放入content目录中，然后运行如下命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./publish.sh</span></span><br></pre></td></tr></table></figure>

<p>当然，在正式发布前通常会先利用本地服务器进行预览，确定没问题后再进行正式发布。</p>
<p>Makefile的内容如下所示：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">PY=python</span><br><span class="line">PELICAN=pelican</span><br><span class="line">BASEDIR=<span class="variable">$(CURDIR)</span></span><br><span class="line">INPUTDIR=<span class="variable">$(BASEDIR)</span>/content</span><br><span class="line">OUTPUTDIR=<span class="variable">$(BASEDIR)</span>/output</span><br><span class="line">CONFFILE=<span class="variable">$(BASEDIR)</span>/pelicanconf.py</span><br><span class="line">PELICANOPTS=</span><br><span class="line"></span><br><span class="line"><span class="section">help:</span></span><br><span class="line">    @echo 'Makefile for a pelican Web site                                      '</span><br><span class="line">    @echo '                                                                     '</span><br><span class="line">    @echo 'Usage:                                                               '</span><br><span class="line">    @echo '   make clean                Empty the OUTPUTDIR                     '</span><br><span class="line">    @echo '   make generate             Generate static files for the web site  '</span><br><span class="line">    @echo '   make serve                Serve site at http://localhost:8000     '</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    @echo -n 'Cleaning Output folder..............'</span><br><span class="line">    @rm -rf <span class="variable">$(OUTPUTDIR)</span>/*</span><br><span class="line">    @echo ''</span><br><span class="line">    @echo 'Done'</span><br><span class="line"></span><br><span class="line"><span class="section">generate: clean</span></span><br><span class="line">    <span class="variable">$(PELICAN)</span> <span class="variable">$(INPUTDIR)</span> -o <span class="variable">$(OUTPUTDIR)</span> -s <span class="variable">$(CONFFILE)</span> <span class="variable">$(PELICANOPTS)</span></span><br><span class="line"></span><br><span class="line"><span class="section">serve: generate</span></span><br><span class="line">    cd <span class="variable">$(OUTPUTDIR)</span> &amp;&amp; <span class="variable">$(PY)</span> -m pelican.server</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: help clean generate serve</span></span><br></pre></td></tr></table></figure>

<p>要预览时，只需要输入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make serve</span></span><br></pre></td></tr></table></figure>

<p>然后在浏览器中访问 <a href="http://localhost:8000" target="_blank" rel="noopener">http://localhost:8000</a> 即可进行本地预览。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1]: http://riku.gitcafe.com/pelican-gitcafe.html</span><br><span class="line">[2]: https://gitcafe.com/GitCafe/Help/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E5%92%8C%E8%AE%BE%E7%BD%AE-Git#wiki</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/Evaluate-Largest-Online-Users/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/Evaluate-Largest-Online-Users/" class="post-title-link" itemprop="url">测试最大在线用户数</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-08-22 00:00:00" itemprop="dateCreated datePublished" datetime="2013-08-22T00:00:00+08:00">2013-08-22</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/性能测试/" itemprop="url" rel="index"><span itemprop="name">性能测试</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><blockquote>
<p>在性能测试工作中，有时需要对业务系统所能支持的最大在线用户数目进行评估。这与我们接触最多的压力测试不一样，因为用户在线时只是与服务器保持连接，并不一定对服务器有业务请求，从而对服务器不一定会产生压力。然而，在线用户数目并非可以无限增长，当在线用户数目达到应用服务器（或者WebLogic等中间件，或者数据库连接池等）的连接数设置的极限时，业务系统同样可能会发生异常，出现新用户无法登录，或者老用户被挤出系统，甚至业务系统宕机的情况。因此，对业务系统的最大在线用户数指标进行测试是极其必要的。</p>
</blockquote>
<p>现有一OA系统，需要测试其支持的最大在线用户数目。已知当使用浏览器登录该系统后，登录用户可持续地保持登录状态，即使长时间不做任何操作也不会自动退出系统；通过该OA系统的在线用户数统计模块可以详细地查看到当前在线的用户。</p>
<h2 id="测试方法分析"><a href="#测试方法分析" class="headerlink" title="测试方法分析"></a>测试方法分析</h2><p>为了测试被测系统所能支持的最大在线用户数，需要不断地使用新用户帐号进行登录操作，在此同时查看被测系统的在线用户数目以及系统的响应情况。</p>
<p>在新增登录用户时需要注意，由于考察的是系统在正常情况下所能支持的在线用户数目，而不是系统在并发压力下的性能响应情况，因此登录用户时最好采用单个用户或少量并发用户（如两个或三个）逐步登录的形式，不同登录批次之间最好能有一定时间间隔，务必使新增登录用户的操作对服务器产生尽可能小的业务压力。</p>
<p>在新增登录用户的过程中，需要对被测系统的在线用户数目进行查看，并着重关注以下几个方面：</p>
<ul>
<li>持续新增登录用户的同时，业务系统中的在线用户数目是否相应地进行增长</li>
<li>持续新增登录用户的过程中，系统登录操作是否产生连接超时的情况，事务的响应时间是否出现大幅度上升的情况，系统登录事务是否出现失败的情况（这需要在脚本中对登录事务做检查点设置）</li>
<li>持续新增登录用户的过程中，定期地在浏览器中手动刷新业务系统界面，查看业务系统是否出现不可访问的情况（如内部服务器错误、宕机等）</li>
</ul>
<p>相应地，测试脚本需符合如下形式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">lr_start_transaction(<span class="string">"进入登录页面"</span>);</span><br><span class="line"><span class="comment">/*此处为进入系统登录界面的脚本*/</span></span><br><span class="line">lr_end_transaction(<span class="string">"进入登录页面"</span>, LR_AUTO);</span><br><span class="line"></span><br><span class="line">lr_start_transaction(<span class="string">"登录系统"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*登录脚本--部分1*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*对系统登录进行校验</span></span><br><span class="line"><span class="comment"> *若成功，即新页面中包含"重新登录"，reLogin_Count&gt;0</span></span><br><span class="line"><span class="comment"> *若失败，reLogin_Count=0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">web_reg_find(<span class="string">"Text=重新登录"</span>,</span><br><span class="line">    <span class="string">"SaveCount=reLogin_Count"</span>,</span><br><span class="line">    LAST );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*登录脚本--部分2（包含检查点内容部分）*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对系统登录结果进行检查</span></span><br><span class="line"><span class="keyword">if</span> (atoi(lr_eval_string(<span class="string">"&#123;reLogin_Count&#125;"</span>)) == <span class="number">0</span>)</span><br><span class="line">&#123;    <span class="comment">//登录失败</span></span><br><span class="line">    lr_error_message(<span class="string">"登录失败!!!--UserName：%s"</span>,lr_eval_string(<span class="string">"&#123;UserName&#125;"</span>));</span><br><span class="line">     <span class="comment">//勾选Fail Open Transations on lr_error_message</span></span><br><span class="line">     <span class="comment">//当执到该lr_error_message时，"登录系统"的Transaction失败</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lr_end_transaction(<span class="string">"登录系统"</span>, LR_AUTO);</span><br></pre></td></tr></table></figure>

<p>以上脚本调试成功后，通过检查点函数及日志信息可以判断出系统登录操作已通过脚本回放成功完成。</p>
<p>理论上，只要VuGen采用不同帐号迭代运行该脚本，由于只是进行系统登录操作而未进行系统注销或退出操作，业务系统中的在线用户数将持续增加。</p>
<p>然而在该OA系统中采用此方法时发现，虽然脚本成功运行，但业务系统中的在线用户数并未增长。这说明LoadRunner与浏览器在访问系统的过程中存在差异性。</p>
<h2 id="脚本及场景设计"><a href="#脚本及场景设计" class="headerlink" title="脚本及场景设计"></a>脚本及场景设计</h2><p>针对上面的问题，通过抓包工具Fiddler2对系统进行网络流量抓包<br>分析可知：用户登录系统后，在未进行任何操作的情况下，浏览器与服务器会定期（间隔30秒）进行通讯交互。如下图所示：</p>
<p><img src="/images/20130822202622_Online-Users-Communication-between-Browser-and-Server.png" alt="Online-Users-Communication-between-Browser-and-Server"></p>
<p>这就解释了为什么用户在浏览器中登录系统后可以长期地保持在线，而通过脚本成功地进行系统登录后却无法保持在线状态；因为VuGen不会像浏览器那样定期地与服务器进行通讯交互。</p>
<p>找出其中的差异后，我们便可在VuGen中用脚本模拟浏览器的定期交互功能，简单的实现方法如下所示。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    web_url(<span class="string">"userAction.struts"</span>,</span><br><span class="line">        <span class="string">"URL=http://10.147.15.28:9001/userAction.struts?actionType=refreshDynaInfo"</span>,</span><br><span class="line">        <span class="string">"Resource=0"</span>,</span><br><span class="line">        <span class="string">"RecContentType=text/html"</span>,</span><br><span class="line">        <span class="string">"Referer=http://10.147.15.28:9001/jsp/oa/infocomm/sms/sysShortMsg/sysShortMsgReflesh.jsp"</span>,</span><br><span class="line">        <span class="string">"Snapshot=t4.inf"</span>,</span><br><span class="line">        <span class="string">"Mode=HTML"</span>,</span><br><span class="line">        LAST);</span><br><span class="line"></span><br><span class="line">    web_url(<span class="string">"userAction.struts_2"</span>,</span><br><span class="line">        <span class="string">"URL=http://10.147.15.28:9001/userAction.struts?actionType=refreshDynaInfo&amp;time=Mon%20Aug%2012%2015:42:04%20UTC+0800%202013"</span>,</span><br><span class="line">        <span class="string">"Resource=0"</span>,</span><br><span class="line">        <span class="string">"RecContentType=text/html"</span>,</span><br><span class="line">        <span class="string">"Referer=http://10.147.15.28:9001/jsp/oa/infocomm/sms/sysShortMsg/reflesh.jsp"</span>,</span><br><span class="line">        <span class="string">"Snapshot=t5.inf"</span>,</span><br><span class="line">        <span class="string">"Mode=HTML"</span>,</span><br><span class="line">        LAST);</span><br><span class="line"></span><br><span class="line">    lr_think_time(<span class="number">30</span>);    <span class="comment">//模拟浏览器与服务器30秒间隔的通讯交互</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么，将系统登录脚本和循环函数都放入Action中，在VuGen中采用迭代运行的方式可行吗？</p>
<p>虽然新增登录用户可以逐个进行，即使用VuGen通过Action迭代的形式采用不同帐号逐个地进行登录操作。但由于用户登录后需要持续间隔地与服务器进行通讯交互才能保持在线，而单线程脚本运行至while(1)后便进入死循环，从而使得Action迭代无效。因此，采用VuGen进行Action迭代的方式是不可行的。</p>
<p>正确的做法是，在Controller中采用逐步加载的方式，使各个虚拟用户独立地运行，从而保证了各虚拟用户登录成功后保持在线状态。</p>
<p>在Controller中的具体配置如下所示：</p>
<ul>
<li>Run Logic：Number of Iterations设置为1</li>
<li>Think Time：Replay think time As recorded</li>
<li>Continue on error：False</li>
<li>Fail open transactions on lr_error_message：True</li>
<li>Schedule：Initialize each Vuser just before it runs</li>
<li>Schedule：Start 1000 Vusers – 1 Vuser every 3 Seconds</li>
<li>Schedule：Run for 5 minutes</li>
</ul>
<p>通过以上配置，可以达到如下效果：</p>
<ul>
<li>每个Vuser只登录一次，然后定期30秒与服务器进行一次交互，保持在线状态</li>
<li>Vuser的登录操作与定期刷新操作不会对服务器造成并发压力，且符合真实业务场景</li>
<li>逐步缓慢地增加在线用户数，当系统出现异常时即可查看到当前的在线用户数目</li>
</ul>
<h2 id="测试方法优化"><a href="#测试方法优化" class="headerlink" title="测试方法优化"></a>测试方法优化</h2><p>通过以上方法可以测试得到业务系统所能承受的“初略的”最大在线用户数目。为什么说是“初略的”呢？因为该方法仍存在缺陷，主要体现在如下两个方面：</p>
<ul>
<li>该方法只适用于测试期间无他人使用系统的情况。如果测试期间同时有其他用户登录系统，或者系统中本身已存在在线用户，则会造成测试得到的结果不准确。</li>
<li>该方法忽略了系统稳定性对在线用户数的影响。举例来说，也许逐步增加在线用户数至500时，系统并没有发生异常，但这并不意味着500个用户长时间处于在线状态时系统不会出现异常。</li>
</ul>
<p>针对以上两方面缺陷，可以做出如下改进：</p>
<ul>
<li>在逐步增加在线用户数的时候，定期（比如间隔3秒）查看业务系统自身统计的在线用户数目，并以该数据为测试结果。</li>
<li>利用之前的方法测试得到业务系统“初略的”最大在线用户数后，使系统长时间保持该数量的在线用户数目，观察系统在长时间运行期间是否会出现异常；若出现异常后，适当减少在线用户数目后重复地进行测试，直到系统可以保持长时间地稳定运行为止，此时对应的在线用户数目即为业务系统所能承受的最大在线用户数目。</li>
</ul>
<p>在本文提到的OA系统中，对链接[<a href="http://10.147.15.28:9001/countAction.struts?actionType=listOnlineUser]进行请求可以返回得到当前系统在线用户数目的统计信息。对应地，设计如下脚本，即可实现对系统实时在线用户数目的查看。" target="_blank" rel="noopener">http://10.147.15.28:9001/countAction.struts?actionType=listOnlineUser]进行请求可以返回得到当前系统在线用户数目的统计信息。对应地，设计如下脚本，即可实现对系统实时在线用户数目的查看。</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Action()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    web_add_cookie(<span class="string">"USERORGID=db93a2M11f6719ff92Mf528764d624db129b32c21fbca0cb8d6; DOMAIN=10.147.15.28"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">        lr_start_transaction(<span class="string">"查看在线用户数目"</span>);</span><br><span class="line"></span><br><span class="line">        web_reg_save_param(<span class="string">"OnlineUsers"</span>,</span><br><span class="line">                <span class="string">"LB=[在线用户数/总用户数：&lt;font color=\"red\"&gt;"</span>,</span><br><span class="line">                <span class="string">"RB=&lt;/font&gt;]"</span>,</span><br><span class="line">                <span class="string">"ORD=2"</span>,</span><br><span class="line">                <span class="string">"Notfound=error"</span>,</span><br><span class="line">                <span class="string">"Search=Body"</span>,</span><br><span class="line">                LAST);</span><br><span class="line"></span><br><span class="line">        web_url(<span class="string">"countAction.struts"</span>,</span><br><span class="line">            <span class="string">"URL=http://10.147.15.28:9001/countAction.struts?actionType=listOnlineUser"</span>,</span><br><span class="line">            <span class="string">"Resource=0"</span>,</span><br><span class="line">            <span class="string">"RecContentType=text/html"</span>,</span><br><span class="line">            <span class="string">"Referer="</span>,</span><br><span class="line">            <span class="string">"Snapshot=t1.inf"</span>,</span><br><span class="line">            <span class="string">"Mode=HTML"</span>,</span><br><span class="line">            LAST);</span><br><span class="line"></span><br><span class="line">        lr_output_message(<span class="string">"当前在线用户数目：%s"</span>, lr_eval_string(<span class="string">"&#123;OnlineUsers&#125;"</span>));</span><br><span class="line"></span><br><span class="line">        lr_end_transaction(<span class="string">"查看在线用户数目"</span>, LR_AUTO);</span><br><span class="line"></span><br><span class="line">        lr_think_time(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/loadrunner-parameter-variable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/loadrunner-parameter-variable/" class="post-title-link" itemprop="url">LoadRuner 中的参数与变量</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-08-12 00:00:00" itemprop="dateCreated datePublished" datetime="2013-08-12T00:00:00+08:00">2013-08-12</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/性能测试/" itemprop="url" rel="index"><span itemprop="name">性能测试</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在LoadRunner脚本开发中，经常会遇到参数与变量相互转换的情况，本文对常见的转换情形进行了方法总结。</p>
<h2 id="变量的赋值"><a href="#变量的赋值" class="headerlink" title="变量的赋值"></a>变量的赋值</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将字符串赋值给变量</span></span><br><span class="line"><span class="keyword">char</span> strTemp[<span class="number">30</span>];</span><br><span class="line"><span class="built_in">strcpy</span>(strTemp, <span class="string">"Hello World!!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//错误的字符串赋值方式</span></span><br><span class="line">strTemp = <span class="string">"Hello World!!"</span>;</span><br><span class="line"><span class="comment">/* 注：</span></span><br><span class="line"><span class="comment"> * 在LR中若直接将字符串赋值给变量，编译时将会报错</span></span><br><span class="line"><span class="comment"> * 报错信息：operands of = have illegal types `char' and `pointer to char'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//将数值赋值给变量</span></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="comment">/* 注：</span></span><br><span class="line"><span class="comment"> * 在LR中，变量的声明一定要放在脚本的最前面，且声明的语句中不要有其他的脚本代码</span></span><br><span class="line"><span class="comment"> * 若将以上申明放置在脚本中部，将会产生如下形式的报错信息</span></span><br><span class="line"><span class="comment"> * illegal statement termination</span></span><br><span class="line"><span class="comment"> * skipping 'int'</span></span><br><span class="line"><span class="comment"> * undeclared identifier 'x'</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="参数的赋值"><a href="#参数的赋值" class="headerlink" title="参数的赋值"></a>参数的赋值</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将字符串赋值给参数</span></span><br><span class="line">lr_save_string(<span class="string">"Hello World!!"</span>,<span class="string">"paraStr"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将变量中的值赋值给参数</span></span><br><span class="line"><span class="keyword">char</span> strTemp[<span class="number">30</span>];</span><br><span class="line"><span class="built_in">strcpy</span>(strTemp, <span class="string">"Hello World"</span>) ;</span><br><span class="line">lr_save_string(strTemp, <span class="string">"paraStr"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将数值直接赋值给参数</span></span><br><span class="line">lr_save_int(<span class="number">123</span>, <span class="string">"paraNum"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将变量中的数值赋值给参数</span></span><br><span class="line"><span class="keyword">int</span> num = <span class="number">10</span>;</span><br><span class="line">lr_save_int(num*<span class="number">2</span>, <span class="string">"paraNum"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="参数的取值"><a href="#参数的取值" class="headerlink" title="参数的取值"></a>参数的取值</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从参数中进行取值，不管参数是字符串还是数值</span></span><br><span class="line">lr_eval_string(<span class="string">"&#123;paraStr&#125;"</span>);</span><br><span class="line">lr_eval_string(<span class="string">"&#123;paraNum&#125;"</span>);</span><br><span class="line"><span class="comment">//取出的值均为字符串类型，因此输出时格式需为"%s"</span></span><br><span class="line">lr_output_message(<span class="string">"%s"</span>, lr_eval_string(<span class="string">"&#123;paraNum&#125;"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="参数-gt-变量"><a href="#参数-gt-变量" class="headerlink" title="参数=&gt;变量"></a>参数=&gt;变量</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将参数转换为字符串变量，参数paraStr中的值为"Hello World!!"</span></span><br><span class="line"><span class="keyword">char</span> strTemp[<span class="number">30</span>];</span><br><span class="line"><span class="built_in">strcpy</span>(strTemp, lr_eval_string(<span class="string">"&#123;paraStr&#125;"</span>));</span><br><span class="line">lr_output_message(<span class="string">"%s"</span>, strTemp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将参数转换为数值变量，参数paraNum中的值为"246"</span></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line">num = atoi(lr_eval_string(<span class="string">"&#123;paraNum&#125;"</span>));    <span class="comment">//将字符串转换为数值</span></span><br><span class="line">lr_output_message(<span class="string">"%d"</span>, num);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将参数格式化输出到变量</span></span><br><span class="line">SeatPrefListCount = atoi( lr_eval_string(<span class="string">"&#123;SeatPrefList_count&#125;"</span>) );</span><br><span class="line"><span class="built_in">sprintf</span>(varRandomSeatPref, <span class="string">"&#123;SeatPrefList_%d&#125;"</span>, <span class="number">1</span>+rand()%SeatPrefListCount);</span><br><span class="line"><span class="comment">//将格式化的随机日期写入变量varRandomDepartDate</span></span><br><span class="line"><span class="built_in">sprintf</span>(varRandomDepartDate, <span class="string">"%d/%d/%d"</span>, <span class="number">1</span>+rand()%<span class="number">12</span>, <span class="number">1</span>+rand()%<span class="number">28</span>, <span class="number">2009</span>+rand()%<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<h2 id="参数-gt-参数"><a href="#参数-gt-参数" class="headerlink" title="参数=&gt;参数"></a>参数=&gt;参数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//参数的复制：将参数paraStr_1的值复制到参数paraStr_2</span></span><br><span class="line">lr_save_string(lr_eval_string(<span class="string">"&#123;paraStr_1&#125;"</span>),<span class="string">"paraStr_2"</span>);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/xiaojianguo.jpg" alt="debugtalk">
            
              <p class="site-author-name" itemprop="name">debugtalk</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">95</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">60</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/debugtalk" title="GitHub &rarr; https://github.com/debugtalk" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:mail@debugtalk.com" title="E-Mail &rarr; mailto:mail@debugtalk.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  
    <div id="sidebar-dimmer"></div>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">debugtalk</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>







  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1257477005&web_id=1257477005"></script>
  </div>



        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  

  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
