<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.0.1">


  <link rel="mask-icon" href="/images/safari-pinned-tab.svg?v=7.0.1" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true,"dimmer":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>

<script>
  (function(i,s,o,g,r,a,m){i["SlardarMonitorObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://i.snssdk.com/slardar/sdk.js?bid=debugtalk","Slardar");
</script>
<script>
  window.Slardar('config', {
    sampleRate: 1,
    bid: 'debugtalk',
    ignoreAjax: [],
    ignoreStatic: [],
    hookFetch: true,
    enableSizeStats: true
  });
  window.Slardar('send', 'pageview');
</script>



  

<script>
  (function(i,s,o,g,r,a,m){i["SlardarMonitorObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://i.snssdk.com/slardar/sdk.js?bid=debugtalk","Slardar");
</script>
<script>
  window.Slardar('config', {
    sampleRate: 1,
    bid: 'debugtalk',
    ignoreAjax: [],
    ignoreStatic: [],
    hookFetch: true,
    enableSizeStats: true
  });
  window.Slardar('send', 'pageview');
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="DebugTalk">
<meta property="og:url" content="https://debugtalk.com/page/8/index.html">
<meta property="og:site_name" content="DebugTalk">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DebugTalk">



  <link rel="alternate" href="/atom.xml" title="DebugTalk" type="application/atom+xml">




  <link rel="canonical" href="https://debugtalk.com/page/8/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>DebugTalk</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=[object Object]"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-81639610-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DebugTalk</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">探索一个软件工程师的无限可能</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/debugtalk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/cheat-in-wechat-moments-voting-activity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/cheat-in-wechat-moments-voting-activity/" class="post-title-link" itemprop="url">微信朋友圈投票活动的刷票案例分析</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2016-04-04T00:00:00+08:00">2016-04-04</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/案例分析/" itemprop="url" rel="index"><span itemprop="name">案例分析</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>现阶段，在微信朋友圈举办的投票活动层出不穷，相信已经有不少同学对此不胜其烦，因为总会时不时地冒出个人（亲戚、朋友、or whatever）来请你帮TA投票。</p>
<p>本文倒没有打算从道德或者情感层面来探讨这个问题，我所感兴趣的是，当前大多数投票活动其实都是存在明显漏洞的，通过简单的技术手段就可以实现“刷票”。</p>
<h2 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h2><p>这里就有一个案例。</p>
<p>某美发网上商城（以下简称S商城）在微信平台上举办了一场在线投票活动，微信用户可通过活动链接访问到投票页面，对喜欢的发型师作品进行投票；每个微信帐号每天只能给单个作品投1张选票。</p>
<p>投票活动页面如下图所示：</p>
<p><img src="/images/voteRobot_01.png" alt="vote activity overview"></p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>表面上看，S商城已经对投票活动进行了反作弊处理，因为限制了每个微信用户每天只能投一张票。如果用户都是正常地通过微信访问这个投票服务进行投票的话，的确是能起到预期效果的。</p>
<p>然而，如果查看投票页面的原始地址，即按住页面向下拖动，会发现屏幕顶端显示为”本网页由XXX提供”，需要注意的是，这里的”XXX”并不是”mp.weixin.qq.com”，而是S商城的域名。也就是说，这个投票活动的程序是运行在S商城的服务器上面的。</p>
<p>基于以上分析，可以推断出用户投票操作的网络拓扑结构示意图应该是这样的：</p>
<p><img src="/images/voteRobot_02.png" alt="vote system network structure"></p>
<p>微信用户访问投票页面时，微信服务器只是进行了请求转发，具体的投票计数与校验都是在S商城的服务器上的。</p>
<p>那么，S商城是怎么来区分投票用户的呢？</p>
<p>这里就涉及到微信公众平台<code>OpenID</code>的概念了。官方对<code>OpenID</code>的解释是：加密后的微信号，每个用户对每个公众号的OpenID是唯一的。</p>
<p>要验证这一点也很容易，只需要通过采用多个微信账号进行投票，并对投票过程进行网络抓包，查看POST中的参数就可以证实。</p>
<p>基于这一点，微信公众平台在转发投票请求时，会在POST参数中包含用户的<code>OpenID</code>；S商城在接收到投票的POST请求后，通过查询当前<code>OpenID</code>是否在当天已经投过票，就可以阻止单一用户重复投票的行为了。</p>
<p>然而，这里面却存在一个很大的漏洞！</p>
<p>S商城只能判断<code>OpenID</code>是否出现了重复，但是却无法校验<code>OpenID</code>的有效性，因为它是无法调用微信服务器来对这个<code>OpenID</code>进行校验的。</p>
<h2 id="VoteRobot实现"><a href="#VoteRobot实现" class="headerlink" title="VoteRobot实现"></a>VoteRobot实现</h2><p>明确了这个漏洞后，要实现刷票就很简单了。</p>
<ul>
<li>采用微信用户正常地进行一次投票操作，对设备进行网络抓包，获取到投票过程中HTTP层面的请求参数和响应内容；</li>
<li>使用Fiddler（或Python脚本）构造投票的HTTP POST请求，保持各参数与真实投票时抓取到的参数内容一致；</li>
<li>随机生成不同的<code>OpenID</code>参数，重复进行POST请求。</li>
</ul>
<p>如果要实现批量刷票，或者刷票自动化操作，那么就可以将刷票请求通过Python脚本来实现；甚至，采用LoadRunner也是可以的。</p>
<p>运行<code>VoteRobot.py</code>，输出日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">======== Start to vote zpid(38), Total votes: 3</span><br><span class="line">1 tickets has been voted, the next ticket will be voted after 35 seconds.</span><br><span class="line">2 tickets has been voted, the next ticket will be voted after 31 seconds.</span><br><span class="line">3 tickets has been voted, the next ticket will be voted after 10 seconds.</span><br><span class="line">======== Voting Ended!</span><br></pre></td></tr></table></figure>

<p>需要注意的是，通常自动化刷票时最好有个随机的时间间隔，并且，最好能动态模拟不同的设备，即修改<code>User-Agent</code>，否则，服务端可以较为容易地识别作弊行为。</p>
<h2 id="作弊与反作弊？"><a href="#作弊与反作弊？" class="headerlink" title="作弊与反作弊？"></a>作弊与反作弊？</h2><p>看到这里，也许有的同学心中窃喜，以后投票都可以采用这种方式“刷票”了么？</p>
<p>很遗憾，当然不是。</p>
<p>其实本文中案例的漏洞是很低级的，只是，当前的确还存在不少比例的投票活动是采用这种模式。</p>
<p>要判断一个投票活动是否可以采用这种方式来作弊也很简单。采用本文中的方法，若查看到活动的网址是非微信官方的，而且整个投票过程也没有额外的校验，那么实现作弊的可能性就很大了；再通过抓包看下通讯交互过程，并用网络请求工具修改参数后重新请求下，即可验证是否真的可以作弊了。</p>
<p>另外，也许有人想问了，网络中的投票活动就没法杜绝“刷票”行为了么？</p>
<p>答案是，完全杜绝的确很难。听说过12306的黄牛党没？听说过Apple Store专业给应用刷榜单的没？听说过“网络水军”、“五毛党”没？</p>
<p>不过，活动举办方可以通过一些手段，大大提高作弊的门槛。例如，当前有不少活动就采用了如下方式：</p>
<ul>
<li>要求投票用户先关注活动举办方的公众号，然后调用微信官方的投票功能；</li>
<li>要求投票用户在投票活动举办方的网站上进行注册（手机号验证、实名验证）</li>
</ul>
<p>不管采用这两种方式中的哪一种，本文中的“刷票”方法就完全失效了。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/render-multi-level-table-in-webpage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/render-multi-level-table-in-webpage/" class="post-title-link" itemprop="url">测试结果报表展现：Web页面绘制多层级表格</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-20 00:00:00" itemprop="dateCreated datePublished" datetime="2016-03-20T00:00:00+08:00">2016-03-20</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-Programming/" itemprop="url" rel="index"><span itemprop="name">2. Programming</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-Programming/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景描述"><a href="#背景描述" class="headerlink" title="背景描述"></a>背景描述</h2><p>在Android性能测试中，每一个测试任务都对应了1个测试用例、1台测试设备、一个测试包，并且在测试结果中包含了多个指标项。通常，我们希望能对两个不同版本测试包的测试结果进行对比，并能在Web页面上以表格的形式进行展现。</p>
<p>很自然地，我们会想到采用如下形式展现对比结果。</p>
<p><img src="/images/render_table_three_levels.png" alt="render table three levels"><br>图1 三层表格</p>
<p>对应地，采用如下数据结构存储结果数据。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">data_hash = &#123;</span><br><span class="line">  "pkg_array": ["pkg1", "pkg2"],</span><br><span class="line">  "data": &#123;</span><br><span class="line">    "testcase1": &#123;</span><br><span class="line">      "device1": &#123;</span><br><span class="line">        "indicator1": ["value1", "value2"],</span><br><span class="line">        "indicator2": ["value3", "value4"],</span><br><span class="line">      &#125;,</span><br><span class="line">      "device2": &#123;</span><br><span class="line">        "indicator1": ["value5", "value6"],</span><br><span class="line">        "indicator2": ["value7", "value8"],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    "testcase2": &#123;</span><br><span class="line">      "device1": &#123;</span><br><span class="line">        "indicator1": ["value9", "value10"],</span><br><span class="line">        "indicator2": ["value11", "value12"],</span><br><span class="line">      &#125;,</span><br><span class="line">      "device2": &#123;</span><br><span class="line">        "indicator1": ["value13", "value14"],</span><br><span class="line">        "indicator2": ["value15", "value16"],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想法明确了，那要怎么实现呢？</p>
<p>对于像我这样没学过前端的人来说，最难的就是如何通过代码绘制层级表格的问题。</p>
<h2 id="第一次尝试：绘制2层表格"><a href="#第一次尝试：绘制2层表格" class="headerlink" title="第一次尝试：绘制2层表格"></a>第一次尝试：绘制2层表格</h2><p>为了简化问题分析过程，先尝试对两层表格进行绘制。</p>
<p><img src="/images/render_table_two_levels.png" alt="render table two levels"><br>图2 两层表格</p>
<p>简化后的数据结构如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">two_level_data_hash = &#123;</span><br><span class="line">  "pkg_array": ["pkg1", "pkg2"],</span><br><span class="line">  "data": &#123;</span><br><span class="line">    "device1": &#123;</span><br><span class="line">      "indicator1": ["value1", "value2"],</span><br><span class="line">      "indicator2": ["value3", "value4"],</span><br><span class="line">    &#125;,</span><br><span class="line">    "device2": &#123;</span><br><span class="line">      "indicator1": ["value5", "value6"],</span><br><span class="line">      "indicator2": ["value7", "value8"],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上表格对应的html代码如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Device<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Indicator<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Pkg1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Pkg2<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">"2"</span>&gt;</span>device1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>indicator1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>value2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>indicator2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>value3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>value4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看出，绘制层级表格的关键在于<code>tr</code>和<code>rowspan</code>的控制上。<br>因此，我们可以尝试采用如下JavaScript代码进行生成。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_two_level_table</span>(<span class="params">two_level_data_hash</span>)</span>&#123;</span><br><span class="line">  pkg_array = two_level_data_hash[<span class="string">"pkg_array"</span>];</span><br><span class="line">  table_header = <span class="string">"&lt;tr&gt;"</span>;</span><br><span class="line">  table_header += <span class="string">"&lt;th&gt;Device&lt;/th&gt;&lt;th colspan='1'&gt;Indicator&lt;/th&gt;"</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> pkg_index <span class="keyword">in</span> pkg_array)&#123;</span><br><span class="line">    table_header += <span class="string">"&lt;th&gt;"</span> + pkg_array[pkg_index] + <span class="string">"&lt;/th&gt;"</span></span><br><span class="line">  &#125;</span><br><span class="line">  table_header += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  data = two_level_data_hash[<span class="string">"data"</span>];</span><br><span class="line">  table_body = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> device <span class="keyword">in</span> data)&#123;</span><br><span class="line">    is_first_indicator_row = <span class="literal">true</span>;</span><br><span class="line">    table_body += <span class="string">"&lt;tr&gt;&lt;td rowspan='"</span> + data[device].length + <span class="string">"'&gt;"</span> + device + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> indicator <span class="keyword">in</span> data[device])&#123;</span><br><span class="line">      <span class="keyword">if</span>(!is_first_indicator_row)&#123;</span><br><span class="line">        table_body += <span class="string">"&lt;tr&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      table_body += <span class="string">"&lt;td&gt;"</span> + indicator + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">      value_list = data[device][indicator];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> index <span class="keyword">in</span> value_list)&#123;</span><br><span class="line">        table_body += <span class="string">"&lt;td&gt;"</span> + value_list[index] + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      table_body += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">      is_first_indicator_row = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    table_body += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  table_content = <span class="string">"&lt;table border='1'&gt;"</span> + table_header + table_body + <span class="string">"&lt;/table&gt;"</span>;</span><br><span class="line">  $(<span class="string">"#table"</span>).html(table_content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在绘制indicator单元格的时候，为了判断当前indicator是否是当前device对应的第一个，即是否需要添加<code>&lt;tr&gt;</code>格式符，我们引入了<code>is_first_indicator_row</code>变量；<code>is_first_indicator_row</code>初始为true，绘制完第一个indicator以后变为false；绘制当前device剩余indicator的时候，由于<code>is_first_indicator_row</code>为false，因此每次都会加上<code>&lt;tr&gt;</code>格式符。</p>
<p>在判断device单元格的行跨度(<code>rowspan</code>)时，由于indicator是device的key，因此我们可以通过当前device中key的数量来得到<code>rowspan</code>，即<code>two_level_data_hash[device].length</code>。</p>
<p>绘制下一个device对应的数据时，再重复以上流程。</p>
<p>可以看出，为了正确打印<code>&lt;tr&gt;</code>格式符，我们做了不少工作。两层表格的绘制方法解决了，那如何绘制三层表格呢？</p>
<h2 id="第二次尝试：绘制3层表格"><a href="#第二次尝试：绘制3层表格" class="headerlink" title="第二次尝试：绘制3层表格"></a>第二次尝试：绘制3层表格</h2><p>回到背景描述里面的需求，若按照上面的思路，我们要绘制三层表格时，就需要引入两个变量，<code>is_first_device_row</code>和<code>is_first_indicator_row</code>，分别用于标记device和indicator是否第一次出现。</p>
<p>那对于<code>rowspan</code>呢？这貌似就有点麻烦了。因为我们在绘制testcase单元格的时候，<code>rowspan</code>的取值应该是当前testcase包含的所有device各自包含的indicator的数量总和，而我们并不能像之前的方式那样直接得到这个数值。</p>
<p>那要怎么处理呢？我们可以尝试写一个函数<code>row_num</code>，来计算得到给定JSON数据里面包含的子节点的总数。</p>
<p>实现方式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_three_level_table</span>(<span class="params">data_hash</span>)</span>&#123;</span><br><span class="line">  pkg_array = data_hash[<span class="string">"pkg_array"</span>];</span><br><span class="line">  table_header = <span class="string">"&lt;tr&gt;"</span>;</span><br><span class="line">  table_header += <span class="string">"&lt;th&gt;TestCase&lt;/th&gt;&lt;th&gt;Device&lt;/th&gt;&lt;th colspan='1'&gt;Indicator&lt;/th&gt;"</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> pkg_index <span class="keyword">in</span> pkg_array)&#123;</span><br><span class="line">    table_header += <span class="string">"&lt;th&gt;"</span> + pkg_array[pkg_index] + <span class="string">"&lt;/th&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  table_header += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  data = data_hash[<span class="string">"data"</span>];</span><br><span class="line">  table_body = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> testcase <span class="keyword">in</span> data)&#123;</span><br><span class="line">    is_first_row_device = <span class="literal">true</span>;</span><br><span class="line">    table_body += <span class="string">"&lt;tr&gt;&lt;td rowspan='"</span> + row_num(data[testcase]) + <span class="string">"'&gt;"</span> + testcase + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> device <span class="keyword">in</span> data[testcase])&#123;</span><br><span class="line">      <span class="keyword">if</span>(!is_first_row_device)&#123;</span><br><span class="line">        table_body += <span class="string">"&lt;tr&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      table_body += <span class="string">"&lt;td rowspan='"</span> + row_num(data[testcase][device]) + <span class="string">"'&gt;"</span> + device + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line"></span><br><span class="line">      is_first_row_indicator = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> indicator <span class="keyword">in</span> data[testcase][device])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_first_row_indicator)&#123;</span><br><span class="line">          table_body += <span class="string">"&lt;tr&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        table_body += <span class="string">"&lt;td&gt;"</span> + indicator + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        value_list = data[testcase][device][indicator];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> index <span class="keyword">in</span> value_list)&#123;</span><br><span class="line">          table_body += <span class="string">"&lt;td&gt;"</span> + value_list[index] + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        table_body += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      table_body += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">      is_first_row_indicator = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    table_body += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">    is_first_row_device = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  table_content = <span class="string">"&lt;table border='1'&gt;"</span> + table_header + table_body + <span class="string">"&lt;/table&gt;"</span>;</span><br><span class="line">  $(<span class="string">"#table"</span>).html(table_content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">row_num</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(data.constructor == <span class="built_in">Array</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(key <span class="keyword">in</span> data)&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = data[key];</span><br><span class="line">    <span class="keyword">if</span>(tmp.constructor == <span class="built_in">Array</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      counter += <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      counter += row_num(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在计算<code>rowspan</code>时，我们用到了递归的方法，实现了对当前testcase或当前device所对应的indicator总数的计算。</p>
<p>通过以上方式，我们实现了三层表格的绘制。可以看出，三层表格的判断逻辑比两层表格复杂了很多，那如果我们还想绘制更多层次的表格呢？显然，这种方法已不再适用，我们不可能每增加一层就新增加一个标识变量，而且对于数据层级不固定的情况，采用这种方式是完全无法实现自适应的。</p>
<h2 id="重构：递归！"><a href="#重构：递归！" class="headerlink" title="重构：递归！"></a>重构：递归！</h2><p>回顾上面的代码，我们不难发现，三层表格的代码相比于两层表格的代码，存在着不少重复，而且可以预见，如果我们采用同样的方式去绘制更多层次表格的话，重复的代码会出现得更多。</p>
<p>一定有更简洁的方法！对，递归！</p>
<p>其实刚才我们在计算<code>rowspan</code>时已经体会到了递归的好处，它可以自适应多层次的数据结构。我们也完全可以将这个思想应用到表格层级的绘制上面。</p>
<p>观察背景描述中的数据结构，不难发现，对比数据存储于Array中，而中间层的value都是Hash结构，因此，我们可以通过这个区别，编写递归调用方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_table</span>(<span class="params">data_hash</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> res = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> data_hash)&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = data_hash[key];</span><br><span class="line">    <span class="keyword">if</span>(tmp.constructor == <span class="built_in">Array</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      res += <span class="string">"&lt;tr&gt;&lt;td rowspan='"</span> + row_num(tmp)+ <span class="string">"'&gt;"</span> + key + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">      <span class="keyword">for</span>(value_index <span class="keyword">in</span> tmp)&#123;</span><br><span class="line">        <span class="keyword">var</span> value = tmp[value_index];</span><br><span class="line">        res += <span class="string">"&lt;td&gt;"</span> + value + <span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      res += <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      res += <span class="string">"&lt;tr&gt;&lt;td rowspan='"</span> + row_num(tmp) + <span class="string">"'&gt;"</span> + key + <span class="string">"&lt;/td&gt;"</span> + <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">      res += render_table(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">row_num</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> counter = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(data.constructor == <span class="built_in">Array</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> counter;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(key <span class="keyword">in</span> data)&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = data[key];</span><br><span class="line">    <span class="keyword">if</span>(tmp.constructor == <span class="built_in">Array</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      counter += <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      counter += row_num(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table_body = <span class="string">""</span>;</span><br><span class="line">table_body += render_table(data_hash);</span><br></pre></td></tr></table></figure>

<p>采用了递归的方式以后，我们就不用再关注表格的层级了，只要是传入数据的数据结构与背景描述里面的类似，那么就可以自动绘制出任意层级的表格。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/developing-idea-production-data-picker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/developing-idea-production-data-picker/" class="post-title-link" itemprop="url">【灵感】线上数据采摘工具（ProductionDataPicker）</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-08 00:00:00" itemprop="dateCreated datePublished" datetime="2016-03-08T00:00:00+08:00">2016-03-08</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/4-ToolsNotes/" itemprop="url" rel="index"><span itemprop="name">4. ToolsNotes</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/4-ToolsNotes/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>不管是是研发同学还是测试同学，日常跟进线上问题时对如下两个场景应该都很熟悉：</p>
<ul>
<li>生产环境上出现了一个bug，想在测试环境或者本地开发环境复现这个bug，而这个bug又与特定数据相关；</li>
<li>在本地开发环境修复了线上bug，想用线上最新特定场景的数据验证下bug是否修复成功。</li>
</ul>
<p>在这两种情况下，都需要将生产环境的数据导入到本地环境。那么怎么进行导入呢？</p>
<p>说到这里，也许已经勾起了你的一把辛酸泪。通常对于这种情况都是这么做的：</p>
<ul>
<li>同步整个生产环境数据库到本地</li>
<li>利用某些数据库管理软件（如Navicat）同步指定场景相关的几张数据表到本地</li>
</ul>
<p>不管是采用以上哪种方式，由于线上数据库数据通常都很大，因此都会导致如下几个痛点：</p>
<ul>
<li>同步时间非常长，每同步一次都要耗费很多时间进行等待，效率极其低下</li>
<li>同步数据量非常大，但绝大多数的数据都是不关注的</li>
<li>对于像我这样本地笔记本电脑总共只有128GB SSD，空闲容量不足5GB的屌丝，想同步都做不到啊</li>
</ul>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>要解决以上问题，其实从原理上讲很简单，就是只同步我们想要的数据，不多一条，也不少一条，刚刚好！</p>
<p>以UC浏览器的性能测试平台UCTC为例，某个测试任务出现异常后，我们想要拿到这个任务相关的所有数据在本地开发环境进行复现调试。单个测试任务相关的数据分布在各个数据库表中，包括任务信息、测试用例、测试设备、测试包、原始测试数据等等。</p>
<p>不难看出，虽然只是一个测试任务，但其相关的数据分布在近10张表中，各张表的数据量从几百到几十万不等。而我们要刚好同步相关数据的意思就是，在测试任务相关的每张表里面，只将特定测试任务的相关数据提取出来，并导入到我们的本地开发环境。这样的话，我们每次只需要同步很少的数据，同步操作基本上可以实现瞬间完成。</p>
<p>如果能有这样的工具，那么前面提到的几个痛点都将不复存在，我们的工作效率必将得到极大的提升。</p>
<p>然而遗憾的是，经过漫长的搜索，发现目前市面上都还没有这样的工具。大多数数据库管理工具只能提供数据库的手动导出和导入整张数据表的功能，即使有些做得更便捷的，也仅限于实现两个数据库的数据同步功能，这些都不能满足我们的期望。</p>
<p>痛点是实实在在的，而又没有可用的工具，那么就这样忍了么？当然不行，We build things!</p>
<p>线上数据采摘工具（ProductionDataPicker）就此诞生了！</p>
<p>to be continued …</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/remote-debugging-with-pycharm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/remote-debugging-with-pycharm/" class="post-title-link" itemprop="url">利用 PyCharm 进行 Python 远程调试</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-07-13 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-13T00:00:00+08:00">2015-07-13</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-Programming/" itemprop="url" rel="index"><span itemprop="name">2. Programming</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-Programming/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景描述"><a href="#背景描述" class="headerlink" title="背景描述"></a>背景描述</h2><p>有时候Python应用的代码在本地开发环境运行十分正常，但是放到线上以后却出现了莫名其妙的异常，经过再三排查以后还是找不到问题原因，于是就在想，要是可以在服务器环境中进行单步跟踪调试就好了。</p>
<p>然而，在服务器系统上安装一个IDE肯定是不现实的；通过SSH远程到服务器端，采用<code>pdb</code>进行调试虽然可行，但是操作还是较为繁琐，而且也不够直观。</p>
<p>那么，是否可以将开发环境中的IDE与服务器环境相连，实现利用开发环境的IDE调试服务器环境中运行的程序呢？<br>答案是肯定的，这就是远程调试（Remote Debug）。</p>
<h2 id="远程调试的工作原理"><a href="#远程调试的工作原理" class="headerlink" title="远程调试的工作原理"></a>远程调试的工作原理</h2><p>远程调试的功能在Eclipse、IntelliJ IDEA等大型IDE中均有支持，实现原理都基本相同，这里采用PyCharm进行说明。</p>
<p>在远程调试的模式下，PyCharm（IDE）扮演服务端（Server）的角色，而运行在远程计算机上的应用程序扮演客户端（Client）的角色。正因如此，进行远程调试时，需要先在本地开发环境中设定端口并启动IDE，IDE会对设定的端口开始监听，等待客户端的连接请求；那远程计算机中的应用程序又是怎样与IDE建立通讯连接的呢？</p>
<p>针对远程调试功能，PyCharm提供了<code>pydevd</code>模块，该模块以<code>pycharm-debug.egg</code>的形式存在于PyCharm的安装路径中。远程计算机安装该库文件后，然后就可以调用<code>pydevd.settrace</code>方法，该方法会指定IDE所在机器的IP地址和监听的端口号，用于与IDE建立连接；建立连接后，便可在IDE中对远程在远程计算机中的程序进行单步调试。</p>
<h2 id="远程调试的配置方法"><a href="#远程调试的配置方法" class="headerlink" title="远程调试的配置方法"></a>远程调试的配置方法</h2><h3 id="1、在远程计算机上安装pydevd模块"><a href="#1、在远程计算机上安装pydevd模块" class="headerlink" title="1、在远程计算机上安装pydevd模块"></a>1、在远程计算机上安装<code>pydevd</code>模块</h3><p>首先，在本地开发环境的PyCharm安装路径中找到<code>pycharm-debug.egg</code>文件（若远程计算机运行的是Python3，则需要<code>pycharm-debug-py3k.egg</code>）；</p>
<p>然后，将<code>pycharm-debug.egg</code>文件拷贝至远程计算机，在远程计算机中将<code>pycharm-debug.egg</code>添加至引用路径，可以采用多种方式：</p>
<ul>
<li>采用<code>easy_install pycharm-debug.egg</code>命令进行安装（pip命令无法安装，只能使用easy_install）</li>
<li>将<code>pycharm-debug.egg</code>添加至<code>PYTHONPATH</code>或<code>sys.path</code>: <code>import sys; sys.path.append(&#39;/home/leo/app-dependancies/pycharm-debug.egg&#39;)</code></li>
<li>解压<code>pycharm-debug.egg</code>，将其中的<code>pydev</code>文件夹拷贝至远程应用程序目录下</li>
</ul>
<p>最后，在远程计算机的Python命令行中输入<code>import pydevd</code>，若没有报错则说明<code>pydevd</code>模块安装成功。</p>
<h3 id="2、在本地开发环境的PyCharm中进行监听配置"><a href="#2、在本地开发环境的PyCharm中进行监听配置" class="headerlink" title="2、在本地开发环境的PyCharm中进行监听配置"></a>2、在本地开发环境的PyCharm中进行监听配置</h3><p>在PyCharm中配置说明如下：</p>
<ul>
<li>【Run】-&gt;【Edit Configurations】</li>
<li>【Add New Configuration】-&gt;【Python Remote Debug】</li>
<li>填写<code>Local host name</code>和<code>Port</code>，其中<code>Local host name</code>指的是本机开发环境的IP地址，而<code>Port</code>则随便填写一个10000以上的即可；需要注意的是，由于远程计算机需要连接至本地开发环境，因此本地IP地址应该保证远程可以访问得到</li>
<li>【Apply】and【OK】</li>
</ul>
<h3 id="3、在本地开发环境的PyCharm中配置Mapping映射"><a href="#3、在本地开发环境的PyCharm中配置Mapping映射" class="headerlink" title="3、在本地开发环境的PyCharm中配置Mapping映射"></a>3、在本地开发环境的PyCharm中配置Mapping映射</h3><h3 id="4、在远程计算机的应用程序中插入代码"><a href="#4、在远程计算机的应用程序中插入代码" class="headerlink" title="4、在远程计算机的应用程序中插入代码"></a>4、在远程计算机的应用程序中插入代码</h3><p>将如下代码插入至远程计算机的应用程序中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pydevd</span><br><span class="line">pydevd.settrace(<span class="string">'100.84.48.156'</span>, port=<span class="number">31235</span>, stdoutToServer=<span class="literal">True</span>, stderrToServer=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>其中，IP地址和端口号要与PyCharm中的监听配置保持一致。</p>
<h3 id="5、在PyCharm中启动Debug-Server"><a href="#5、在PyCharm中启动Debug-Server" class="headerlink" title="5、在PyCharm中启动Debug Server"></a>5、在PyCharm中启动<code>Debug Server</code></h3><p>【Run】-&gt;【Debug…】，选择刚创建的远程调试配置项，在<code>Debug Console</code>中会显示如下信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Starting debug server at port 31235</span><br><span class="line">Waiting <span class="keyword">for</span> process connection...</span><br><span class="line">Use the following code to connect to the debugger:</span><br><span class="line">import pydevd</span><br><span class="line">pydevd.settrace(<span class="string">'100.84.48.156'</span>, port=31235, stdoutToServer=True, stderrToServer=True)</span><br></pre></td></tr></table></figure>

<p>这说明<code>Debug Server</code>已经启动并处于监听状态。</p>
<h3 id="6、在远程计算机中启动应用程序"><a href="#6、在远程计算机中启动应用程序" class="headerlink" title="6、在远程计算机中启动应用程序"></a>6、在远程计算机中启动应用程序</h3><p>在远程计算机中启动应用程序，当执行到<code>pydevd.settrace</code>语句时，便会与本地开发环境中的PyCharm建立通讯连接，接下来便可以在本地IDE中进行单步调试了。</p>
<p>需要注意的是，本地开发环境必须保证IP地址和端口号可从远程计算机访问得到，否则会无法建立连接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ telnet 100.84.48.156 31235</span><br><span class="line">Trying 100.84.48.156...</span><br><span class="line">telnet: Unable to connect to remote host: Connection refused</span><br><span class="line"></span><br><span class="line">$ python devicedectector.py</span><br><span class="line">Could not connect to 100.84.48.156: 31236</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/pycharm-debug.egg/pydevd_comm.py"</span>, line 478, <span class="keyword">in</span> StartClient</span><br><span class="line">    s.connect((host, port))</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/socket.py"</span>, line 224, <span class="keyword">in</span> meth</span><br><span class="line">    <span class="built_in">return</span> getattr(self._sock,name)(*args)</span><br><span class="line">error: [Errno 111] Connection refused</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://stackoverflow.com/questions/6989965/how-do-i-start-up-remote-debugging-with-pycharm" target="_blank" rel="noopener">http://stackoverflow.com/questions/6989965/how-do-i-start-up-remote-debugging-with-pycharm</a><br><a href="https://www.jetbrains.com/pycharm/help/remote-debugging.html" target="_blank" rel="noopener">https://www.jetbrains.com/pycharm/help/remote-debugging.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/android-development-environment-device-configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/android-development-environment-device-configuration/" class="post-title-link" itemprop="url">Android开发环境配置4：配置Android设备</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-07-10 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-10T00:00:00+08:00">2015-07-10</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对于用于持续集成性能测试（或者自动化测试）的Android设备，在刷机之后需要进行一些配置。不同的Android系统版本在设置上会有些差异，但基本上都应包含的设置项都类似，如下是以Nexus 5为例进行说明。</p>
<p>【Settings】-&gt;【About Phone】，连续点击7次【Build number】，开启开发者模式；<br>【Settings】-&gt;【Developer options】，开启【stay awake】和【USB debugging】；<br>【Settings】-&gt;【Security】，开启【Unknown sources】(Allow installation of apps from sources other than the Play Store)，因为实验室的包还未获得Play Store的签名，因此必须开启这个开关，才能正常安装开发包。<br>【Settings】-&gt;【Security】，将【Screen lock】设置为None，防止设备出现锁屏的情况。<br>【Settings】-&gt;【Display】，将【Sleep】设置为最长时限。<br>【Settings】-&gt;【Display】，将【Auto-rotate screen】关闭，因为某些测试场景时会用到屏幕分辨率。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/android-development-environment-root/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/android-development-environment-root/" class="post-title-link" itemprop="url">Android 开发环境配置3：Root</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-07-05 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-05T00:00:00+08:00">2015-07-05</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="What-is-root"><a href="#What-is-root" class="headerlink" title="What is root"></a>What is root</h2><h3 id="root的原理"><a href="#root的原理" class="headerlink" title="root的原理"></a>root的原理</h3><p>破解Android root权限的本质是：</p>
<p>在系统中加入一个任何用户都可能用于登陆的su命令。或者说替换掉系统中的su程序，因为系统中的默认su程序需要验证实际用户权限，只有root和shell用户才有权运行系统默认的su程序，其他用户运行都会返回错误。而破解后的su将不检查实际用户权限，这样普通的用户也将可以运行su程序，也可以通过su程序将自己的权限提升。</p>
<h3 id="判断手机是否root"><a href="#判断手机是否root" class="headerlink" title="判断手机是否root"></a>判断手机是否root</h3><p>通过<code>adb shell</code>连接至手机以后，执行<code>su</code>命令，如果无法执行，则说明该手机无<code>root</code>权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">shell@hammerhead:/ $</span><br><span class="line">shell@hammerhead:/ $ su</span><br><span class="line">su <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure>

<h2 id="How-to-root"><a href="#How-to-root" class="headerlink" title="How to root"></a>How to root</h2><p>本文中用到的操作系统为Linux（Debian）；Android设备型号为Nexus 5（HAMMERHEAD），Android版本为4.4.4（Build Num KTU84P）</p>
<h3 id="准备工作（Prerequisites）"><a href="#准备工作（Prerequisites）" class="headerlink" title="准备工作（Prerequisites）"></a>准备工作（Prerequisites）</h3><ul>
<li>配置Android调试环境：安装adb和fastboot工具，开启USB调试模式（USB debugging），建立手机与电脑之间的USB调试连接。</li>
<li>Android设备的Bootloader已完成解锁（unlocked）。</li>
<li>下载已经完成root的boot.img，例如，CF-Auto-Root-hammerhead-hammerhead-nexus5.img</li>
<li>下载第三方<code>TWRP Recovery</code>镜像包，例如，openrecovery-twrp-2.8.7.1-hammerhead.img</li>
</ul>
<h3 id="方法1：flash-rooted-boot-img"><a href="#方法1：flash-rooted-boot-img" class="headerlink" title="方法1：flash rooted boot.img"></a>方法1：flash <code>rooted</code> boot.img</h3><p>进行root操作，最便捷方式的便是刷入已经root过的<code>boot.img</code>对原有<code>boot</code>区域进行擦写覆盖。<br>对于Nexus设备，可以在<a href="https://autoroot.chainfire.eu/" target="_blank" rel="noopener"><code>CF-Auto-Root Repository</code></a>网站上下载对应设备型号的镜像文件，该镜像中包含了<code>SuperSU</code>程序。</p>
<p>在<code>flash</code>操作前，先将设备切换至<code>fastboot</code>模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb reboot bootloader</span><br></pre></td></tr></table></figure>

<p>在<code>fastboot</code>模式下，在电脑的命令终端中执行如下命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot flash boot CF-Auto-Root-hammerhead-hammerhead-nexus5.img</span><br><span class="line">sending <span class="string">'boot'</span> (9222 KB)...</span><br><span class="line">OKAY [  0.525s]</span><br><span class="line">writing <span class="string">'boot'</span>...</span><br><span class="line">OKAY [  0.787s]</span><br><span class="line">finished. total time: 1.313s</span><br><span class="line"></span><br><span class="line">$ fastboot reboot</span><br><span class="line">rebooting...</span><br><span class="line"></span><br><span class="line">finished. total time: 0.511s</span><br></pre></td></tr></table></figure>

<p>采用<code>fastboot flash boot XXX_boot.img</code>进行操作时，手机会将<code>XXX_boot.img</code>下载至设备并对<code>boot</code>区域进行擦写覆盖，从而使手机获得root权限。即使手机再次重启，root权限仍然存在。</p>
<p>再次通过<code>adb shell</code>连接至手机，可以看见，现在已经获取到了<code>root</code>权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">root@hammerhead:/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="方法2、在Recovery环境下安装SuperSU"><a href="#方法2、在Recovery环境下安装SuperSU" class="headerlink" title="方法2、在Recovery环境下安装SuperSU"></a>方法2、在<code>Recovery</code>环境下安装<code>SuperSU</code></h3><p>该种方法的实现思路在于，给手机安装<code>Custom Recovery</code>，然后在<code>recovery</code>模式下手工安装<code>SuperSU</code>。</p>
<p>具体的操作方式在《<a href="!--￼12--">详解Recovery</a>》一文中进行了介绍。</p>
<h3 id="方法3、采用TWRP-Recovery的OpenRecoveryScript引擎执行命令"><a href="#方法3、采用TWRP-Recovery的OpenRecoveryScript引擎执行命令" class="headerlink" title="方法3、采用TWRP Recovery的OpenRecoveryScript引擎执行命令"></a>方法3、采用<code>TWRP Recovery</code>的OpenRecoveryScript引擎执行命令</h3><p>对于<code>2.1</code>及以上版本的<code>TWRP Recovery</code>中，可以使用<code>OpenRecoveryScript</code>引擎，在<code>TWRP Recovery</code>启动时执行命令。</p>
<h4 id="1、传输root文件至Android设备"><a href="#1、传输root文件至Android设备" class="headerlink" title="1、传输root文件至Android设备"></a>1、传输root文件至Android设备</h4><p>在Android设备未获得root权限之前，具有Write权限的文件夹并不多，通常可将要写入的文件传输至<code>/data/local/tmp/</code>路径下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb push UPDATE-SuperSU-v2.46.zip /data/<span class="built_in">local</span>/tmp/UPDATE-SuperSU-v2.46.zip</span><br><span class="line">$ adb push busybox-signed.zip /data/<span class="built_in">local</span>/tmp/busybox-signed.zip</span><br></pre></td></tr></table></figure>

<h4 id="2、获取临时root权限"><a href="#2、获取临时root权限" class="headerlink" title="2、获取临时root权限"></a>2、获取临时root权限</h4><p>由于后续操作中要向<code>/cache/recovery/</code>目录写入文件，需要用到root权限。针对这种情况，可以采用已经root过的boot.img进行启动，临时获得root权限。</p>
<p>首先，将设备切换至<code>fastboot</code>模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb reboot bootloader</span><br></pre></td></tr></table></figure>

<p>然后，采用已经root过的boot.img进行启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot boot modified_boot_hammerhead_4.4.4_KTU84P.img</span><br><span class="line">downloading <span class="string">'boot.img'</span>...</span><br><span class="line">OKAY [  0.463s]</span><br><span class="line">booting...</span><br><span class="line">OKAY [  0.110s]</span><br><span class="line">finished. total time: 0.573s</span><br></pre></td></tr></table></figure>

<p>此处与方法1的区别在于，这里只是临时地采用已经root过的boot.img进行启动，但并没有对<code>boot</code>分区进行写入。当手机重启后，仍然是采用原有的<code>kernel</code>进行启动。</p>
<h4 id="3、创建openrecoveryscript文件"><a href="#3、创建openrecoveryscript文件" class="headerlink" title="3、创建openrecoveryscript文件"></a>3、创建<code>openrecoveryscript</code>文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch openrecoveryscript</span><br></pre></td></tr></table></figure>

<p>在<code>openrecoveryscript</code>文件中，写入如下内容。其中，<code>zip</code>软件包的路径要求是存在于Android设备中的完整路径。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># openrecoveryscript</span><br><span class="line"><span class="keyword">set</span> tw_signed_zip_verify <span class="number">0</span></span><br><span class="line">install /data/local/tmp/perm-recovery-signed.zip</span><br><span class="line">install /data/local/tmp/UPDATE-SuperSU-v2.<span class="number">46</span>.zip</span><br><span class="line">install /data/local/tmp/busybox-signed.zip</span><br></pre></td></tr></table></figure>

<h4 id="4、写入openrecoveryscript文件"><a href="#4、写入openrecoveryscript文件" class="headerlink" title="4、写入openrecoveryscript文件"></a>4、写入<code>openrecoveryscript</code>文件</h4><p>此处就是需要临时用到root权限的地方。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb push openrecoveryscript /cache/recovery/openrecoveryscript</span><br><span class="line">2 KB/s (169 bytes <span class="keyword">in</span> 0.057s)</span><br></pre></td></tr></table></figure>

<p>如果没有root权限，写入文件时会提示<code>Permission denied</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb push openrecoveryscript /cache/recovery/openrecoveryscript</span><br><span class="line">failed to copy <span class="string">'openrecoveryscript'</span> to <span class="string">'/cache/recovery/openrecoveryscript'</span>: Permission denied</span><br></pre></td></tr></table></figure>

<h4 id="5、启动TWRP-Recovery环境"><a href="#5、启动TWRP-Recovery环境" class="headerlink" title="5、启动TWRP Recovery环境"></a>5、启动<code>TWRP Recovery</code>环境</h4><p>启动<code>TWRP Recovery</code>时，会执行<code>/cache/recovery/openrecoveryscript</code>文件中的命令，即安装<code>SuperSU</code>等root软件。</p>
<p>如果手机之前并未安装<code>TWRP Recovery</code>，也可以直接采用<code>TWRP Recovery</code>的镜像包进行启动，同样可以完成<code>/cache/recovery/openrecoveryscript</code>文件中命令的执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot boot openrecovery-twrp-2.8.7.1-hammerhead.img</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/android-development-environment-recovery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/android-development-environment-recovery/" class="post-title-link" itemprop="url">Android开发环境配置2：详解Recovery</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-07-04 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-04T00:00:00+08:00">2015-07-04</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>不管是尝试对Android手机进行刷机的普通用户，还是刚接触Android应用开发的开发者，都会接触到Recovery。本文将从什么是Recovery，怎么在Android设备中安装Recovery环境，如何使用Recovery几个方面对Android Recovery进行介绍。</p>
<h2 id="What-is-Recovery"><a href="#What-is-Recovery" class="headerlink" title="What is Recovery"></a>What is Recovery</h2><p>通常，在Android设备中会预装<code>Recovery</code>环境，可以用于还原出厂设置、升级操作系统、以及进行问题诊断等。</p>
<p>从类别上，<code>Recovery</code>环境分为两种，Google官方的（the Stock Recovery）<code>Recovery</code>环境和第三方的<code>Recovery</code>环境（the Custom Recovery）。</p>
<h3 id="1、the-Stock-Recovery"><a href="#1、the-Stock-Recovery" class="headerlink" title="1、the Stock Recovery"></a>1、the Stock Recovery</h3><p>Google官方的<code>Recovery</code>环境提供的功能十分有限，主要包括：</p>
<ul>
<li>重置出厂设置，清除所有数据</li>
<li>擦除cache分区</li>
<li>刷入官方的升级文件来升级系统</li>
</ul>
<h3 id="2、the-Custom-Recovery"><a href="#2、the-Custom-Recovery" class="headerlink" title="2、the Custom Recovery"></a>2、the Custom Recovery</h3><p>针对Google官方<code>Recovery</code>环境功能的不足，许多组织、机构或个人定制了功能更为强大的<code>Recovery</code>环境，统称为第三方<code>Recovery</code>环境。当前最为流行的有两个：ClockworkMod Recovery (CWM)、Team Win Recovery Project (TWRP)。</p>
<p>第三方<code>Recovery</code>环境除了具有Google官方<code>Recovery</code>环境的功能外，还增加了其它特性，主要包括：</p>
<ul>
<li>创建、恢复系统备份</li>
<li>安装自定义的ROM</li>
<li>安装、删除应用程序</li>
</ul>
<h2 id="How-to-Install-Recovery"><a href="#How-to-Install-Recovery" class="headerlink" title="How to Install Recovery"></a>How to Install Recovery</h2><p>通常，Android设备出厂时都会带有官方的<code>Recovery</code>环境。如果我们需要获取更多的功能，就需要自己安装第三方<code>Recovery</code>环境来替换官方的<code>Recovery</code>环境。</p>
<h3 id="1、准备工作（Prerequisites）"><a href="#1、准备工作（Prerequisites）" class="headerlink" title="1、准备工作（Prerequisites）"></a>1、准备工作（Prerequisites）</h3><ul>
<li>配置Android调试环境：安装adb和fastboot工具，开启USB调试模式（USB debugging），建立手机与电脑之间的USB调试连接。</li>
<li>Android设备的Bootloader已完成解锁（unlocked）。</li>
<li>下载第三方<code>Recovery</code>镜像包，例如，openrecovery-twrp-2.8.7.1-hammerhead.img</li>
</ul>
<h3 id="2、切换至fastboot模式"><a href="#2、切换至fastboot模式" class="headerlink" title="2、切换至fastboot模式"></a>2、切换至fastboot模式</h3><p>在<code>flash</code>操作前，先将设备切换至<code>fastboot</code>模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb reboot bootloader</span><br></pre></td></tr></table></figure>

<p>通过<code>fastboot devices</code>命令可以查看到手机与电脑直接的连接状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot devices</span><br><span class="line">03f7fc7ad0081a10	fastboot</span><br></pre></td></tr></table></figure>

<h3 id="3、安装Custom-Recovery"><a href="#3、安装Custom-Recovery" class="headerlink" title="3、安装Custom Recovery"></a>3、安装Custom Recovery</h3><p>在<code>fastboot</code>模式下，在电脑的命令终端中执行如下命令，写入<code>recovery.img</code>，并进行重启。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot flash recovery openrecovery-twrp-2.8.7.1-hammerhead.img</span><br><span class="line">sending <span class="string">'recovery'</span> (14694 KB)...</span><br><span class="line">OKAY [  0.709s]</span><br><span class="line">writing <span class="string">'recovery'</span>...</span><br><span class="line">OKAY [  1.133s]</span><br><span class="line">finished. total time: 1.842s</span><br><span class="line"></span><br><span class="line">$ fastboot reboot</span><br><span class="line">rebooting...</span><br><span class="line">finished. total time: 0.408s</span><br></pre></td></tr></table></figure>

<h2 id="How-to-Use-Recovery"><a href="#How-to-Use-Recovery" class="headerlink" title="How to Use Recovery"></a>How to Use Recovery</h2><h3 id="进入Recovery环境"><a href="#进入Recovery环境" class="headerlink" title="进入Recovery环境"></a>进入Recovery环境</h3><p>在手机开机状态下，可以通过如下命令进入<code>Recovery</code>环境。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ adb reboot recovery</span><br><span class="line">$ adb shell</span><br><span class="line">~ <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>从上可以看出，在<code>Recovery</code>环境下，用户具有<code>root</code>权限。</p>
<h3 id="在Recovery环境的手机资源管理器中安装zip格式的软件"><a href="#在Recovery环境的手机资源管理器中安装zip格式的软件" class="headerlink" title="在Recovery环境的手机资源管理器中安装zip格式的软件"></a>在Recovery环境的手机资源管理器中安装<code>zip</code>格式的软件</h3><p>如果要安装某些<code>root</code>权限的软件，例如<code>SuperSU.zip</code>，而手机却没有root权限，就可以在<code>Recovery</code>环境下进行安装。</p>
<p>在<code>Recovery</code>环境下，将要安装的应用程序安装包push至手机任意文件夹。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb push UPDATE-SuperSU-v2.46.zip /sdcard/!ReadyToFlash/Root_Files/UPDATE-SuperSU-v2.46.zip</span><br><span class="line">4604 KB/s (4017098 bytes <span class="keyword">in</span> 0.852s)</span><br></pre></td></tr></table></figure>

<p>然后在手机<code>Recovery</code>环境的资源管理器中找到该文件，点击安装即可。</p>
<h3 id="采用sideload方式安装zip格式的软件"><a href="#采用sideload方式安装zip格式的软件" class="headerlink" title="采用sideload方式安装zip格式的软件"></a>采用sideload方式安装zip格式的软件</h3><p>在<code>Recovery</code>环境下，在手机端开启<code>ADB Sideload</code>，开启后，可以看到手机处于<code>sideload</code>模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">03f7fc7ad0081a10	sideload</span><br></pre></td></tr></table></figure>

<p>采用<code>adb sideload &lt;filename.Zip&gt;</code>命令，即可进行<code>zip</code>软件包的安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb sideload busybox-signed.zip</span><br><span class="line">Total xfer: 1.24x</span><br></pre></td></tr></table></figure>

<p>在手机端可以看到如下日志信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Undating partition details...</span><br><span class="line">...done</span><br><span class="line">Full  SELinux support is present.</span><br><span class="line">MTP enabled</span><br><span class="line">Starting ADB  sideload feature ...</span><br><span class="line">Installing &apos;/sideload/package.zip&apos;...</span><br><span class="line">************************</span><br><span class="line">Install Busybox apk</span><br><span class="line">************************</span><br><span class="line">- Mounting file  systems ...</span><br><span class="line">- Installing Busybox free ...</span><br><span class="line">- Unmounting file system ...</span><br><span class="line">Done!</span><br></pre></td></tr></table></figure>

<h3 id="在Recovery启动过程中执行命令"><a href="#在Recovery启动过程中执行命令" class="headerlink" title="在Recovery启动过程中执行命令"></a>在Recovery启动过程中执行命令</h3><p>对于<code>2.1</code>及以上版本的<code>TWRP Recovery</code>中，可以使用<code>OpenRecoveryScript</code>引擎，在<code>TWRP Recovery</code>启动时执行命令。</p>
<p>具体的方式为，在Android设备的<code>/cache/recovery/</code>目录下创建<code>openrecoveryscript</code>文件，并在其中写入执行命令。</p>
<p>例如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># /cache/recovery/openrecoveryscript</span><br><span class="line"><span class="keyword">set</span> tw_signed_zip_verify <span class="number">0</span></span><br><span class="line">install /data/local/tmp/perm-recovery-signed.zip</span><br><span class="line">install /data/local/tmp/UPDATE-SuperSU-v2.<span class="number">46</span>.zip</span><br><span class="line">install /data/local/tmp/busybox-signed.zip</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/android-development-environment-bootloader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/android-development-environment-bootloader/" class="post-title-link" itemprop="url">Android开发环境配置1：详解Bootloader</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-07-03 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-03T00:00:00+08:00">2015-07-03</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在刚接触Android开发时，通常需要对设备进行root操作，而在root之前，必须要做的一步就是先对设备的Bootloader进行解锁。那么什么是Bootloader？为什么必须要对Bootloader进行解锁？如何对Bootloader进行解锁？本文便围绕着几个问题展开进行介绍。</p>
<h2 id="About-Bootloader"><a href="#About-Bootloader" class="headerlink" title="About Bootloader"></a>About Bootloader</h2><p>顾名思义，Bootloader是操作系统在启动之前需要执行的一段小程序。通过这段小程序，我们可以初始化硬件设备、建立内存空间的映射表，从而建立适当的系统软硬件环境，为最终调用操作系统内核做好准备。</p>
<p>虽然Android系统是开源的，但是设备制造商为了保证系统的稳定性，以及维护自身某些方面的利益，并不希望用户更换为其它厂商的ROM。因此，通常各家设备制造商都会对Bootloader进行加锁。在设备Bootloader处于锁定状态时，无法对ROM进行更改，不能进行root操作，也无法刷机为别的ROM。而要解除这些限制，就需要对Bootloader进行解锁。</p>
<h2 id="How-to-Unlock-Bootloader"><a href="#How-to-Unlock-Bootloader" class="headerlink" title="How to Unlock Bootloader"></a>How to Unlock Bootloader</h2><p>不同机型以及不同Android版本的Bootloader的解锁方式略有不同，但基本思路和步骤都是类似的。</p>
<p>本文以设备机型Nexus 5、ROM版本4.4.4为例，讲解解锁Bootloader的具体步骤；PC机的操作系统为Linux（Debian）。</p>
<h3 id="1、准备工作（Prerequisites）"><a href="#1、准备工作（Prerequisites）" class="headerlink" title="1、准备工作（Prerequisites）"></a>1、准备工作（Prerequisites）</h3><ul>
<li>配置Android调试环境：安装adb和fastboot工具，开启USB调试模式（USB debugging），建立手机与电脑之间的USB调试连接。</li>
<li>数据备份：需要注意的是，bootloader解锁操作会将手机恢复至出厂设置，并清空所有用户数据。因此，在解锁前需要进行必要的数据备份。</li>
</ul>
<h3 id="2、将手机切换至fastboot模式"><a href="#2、将手机切换至fastboot模式" class="headerlink" title="2、将手机切换至fastboot模式"></a>2、将手机切换至<code>fastboot</code>模式</h3><p>不管是要查看Bootloader是否锁定，还是要对Bootloader进行解锁、锁定操作，均需要将手机切换至<code>fastboot</code>模式。切换至<code>fastboot</code>模式可以采用如下两种方式中的任意一种。</p>
<ul>
<li>采用<code>adb</code>命令：将手机开机后连接至电脑，在命令终端中输入<code>adb reboot bootloader</code>。</li>
<li>开机时采用组合按键：将手机关机，同时按住组合按键数秒；不同机型的组合按键略有不同，Nexus 5的组合按键为<code>Volume Down</code>和<code>Power</code>。</li>
</ul>
<p>进入到<code>fastboot</code>模式后，可以看到如下信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FASTBOOT MODE</span><br><span class="line">PRODUCT_NAME - hammerhead</span><br><span class="line">VARIANT - hammerhead D821(E) 16GB</span><br><span class="line">HW VERSION - rev_11</span><br><span class="line">BOOTLOADER VERSION - HHZ11k</span><br><span class="line">BASEBAND VERSION - M897aA-2.0.50.1.16</span><br><span class="line">CARRIER INFO - None</span><br><span class="line">SERIAL NUMBER - 03f7fc7ad0081a10</span><br><span class="line">SIGNING - production</span><br><span class="line">SECURE BOOT - enabled</span><br><span class="line">LOCK STATE - locked</span><br></pre></td></tr></table></figure>

<p>在<code>LOCK STATE</code>一项中，可以看到手机当前处于锁定（locked）状态，若需要进行<code>root</code>操作，则必须先进行解锁（unlock）。如果手机已经处于解锁（unlocked）状态了，则不用再进行<code>unlock</code>操作。</p>
<h3 id="3、对锁定（locked）设备进行解锁（unlock）操作"><a href="#3、对锁定（locked）设备进行解锁（unlock）操作" class="headerlink" title="3、对锁定（locked）设备进行解锁（unlock）操作"></a>3、对锁定（locked）设备进行解锁（unlock）操作</h3><p>解锁操作需要将手机通过USB数据线与电脑连接，在电脑的命令终端中通过<code>fastboot</code>工具命令进行解锁操作。</p>
<p>首先，保持手机与电脑的USB连接，在命令终端中查看手机在<code>fastboot</code>模式下与电脑的连接状态。若连接正常，则可以看到如下信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot devices</span><br><span class="line">03f7fc7ad0081a10	fastboot</span><br></pre></td></tr></table></figure>

<p>然后，在电脑的命令终端中输入如下命令。在手机上会显示<code>Unblock bootloader?</code>警告提示信息，用手机的音量键选择<code>Yes</code>后，按下手机的电源键进行确认。接下来手机便会进行unlock操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot oem unlock</span><br><span class="line">...</span><br><span class="line">OKAY [ 14.907s]</span><br><span class="line">finished. total time: 14.907s</span><br></pre></td></tr></table></figure>

<p>出现如上响应信息后，则表明手机已经解锁成功。在手机屏幕上，也可以看到<code>fastboot</code>模式页面中，<code>LOCK STATE</code>的属性值已经变为<code>unlocked</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot reboot</span><br></pre></td></tr></table></figure>

<p>手机unlock完成后，会恢复到出厂设置，<code>USB调试模式</code>设置也已失效，需要重新进行设置。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/android-development-environment-adb-and-fastboot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/android-development-environment-adb-and-fastboot/" class="post-title-link" itemprop="url">Android开发环境配置0：adb和fastboot</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-07-02 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-02T00:00:00+08:00">2015-07-02</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1、安装adb和fastboot"><a href="#1、安装adb和fastboot" class="headerlink" title="1、安装adb和fastboot"></a>1、安装adb和fastboot</h2><p>在对Android进行调试时，常用的工具有adb和fastboot。</p>
<h3 id="Install-Android-SDK"><a href="#Install-Android-SDK" class="headerlink" title="Install Android SDK"></a>Install Android SDK</h3><p>adb和fastboot包含在Android SDK的<code>Platform-tools package</code>里面，安装Android SDK后也就具备了adb和fastboot工具。</p>
<p>下载并安装<a href="https://developer.android.com/sdk/index.html#Other" target="_blank" rel="noopener">Android SDK tools</a>，打开<code>SDK Manager</code>并安装<code>Android SDK Platform-tools package</code>。</p>
<p>安装完成后，adb和fastboot的存放路径为<code>&lt;path-to-sdk&gt;/platform-tools</code>。为了方便后续使用，可对其配置环境变量。</p>
<p><code>vim ~/.bashrc</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -d <span class="string">"&lt;path-to-sdk&gt;/platform-tools"</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="string">"&lt;path-to-sdk&gt;/platform-tools:<span class="variable">$PATH</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="Install-from-the-command-line"><a href="#Install-from-the-command-line" class="headerlink" title="Install from the command line"></a>Install from the command line</h3><p>如果只是使用adb和fastboot工具，而不想安装完整的<code>Android SDK</code>，可以采用如下方式单独进行安装。</p>
<p>for debian-based Linux distributions:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install android-tools-adb</span><br><span class="line">$ sudo apt-get install android-tools-fastboot</span><br></pre></td></tr></table></figure>

<p>for rpm-based Linux distributions(Fedora/Centos/RHEL):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install android-tools</span><br></pre></td></tr></table></figure>

<p>在<code>Mac OS X</code>中，可以采用<code>homebrew</code>进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install android-platform-tools</span><br></pre></td></tr></table></figure>

<h2 id="2、开启USB调试模式（USB-debugging）"><a href="#2、开启USB调试模式（USB-debugging）" class="headerlink" title="2、开启USB调试模式（USB debugging）"></a>2、开启USB调试模式（USB debugging）</h2><p>对手机进行unlock或root操作需要开启手机的USB调试模式，该设置在手机设置菜单的开发者选项（Developer Options）里面。<br>对于<code>3.2</code>及以前的Android版本，开发者选项的设置位置为：<code>Settings &gt; Applications &gt; Development</code>；<br>对于<code>4.0</code>及以上的Android版本，开发者选项的设置位置为：<code>Setting -&gt; Developer Options</code>；需要注意的是，对于<code>4.2</code>及以上的Android版本，开发者选项默认是隐藏的，开启方式为：进入<code>Setting -&gt; About Phone</code>，连续点击7次<code>Build number</code>。</p>
<p>进入开发者选项设置页面，开启开发者选项，并勾选USB调试模式。</p>
<h2 id="3、建立手机与电脑之间的USB调试连接"><a href="#3、建立手机与电脑之间的USB调试连接" class="headerlink" title="3、建立手机与电脑之间的USB调试连接"></a>3、建立手机与电脑之间的USB调试连接</h2><p>对于Windows/Mac OSX的开发环境，安装好adb的USB驱动即可。<br>对于Linux（Debian based）系统的开发环境，若要使用adb或者fastboot工具对手机进行USB调试，则需要配置<code>udev</code>规则。</p>
<h3 id="创建并配置51-android-rules文件"><a href="#创建并配置51-android-rules文件" class="headerlink" title="创建并配置51-android.rules文件"></a>创建并配置<code>51-android.rules</code>文件</h3><p>创建<code>51-android.rules</code>文件，并设置Read权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo touch /etc/udev/rules.d/51-android.rules</span><br><span class="line">$ sudo chmod a+r /etc/udev/rules.d/51-android.rules</span><br><span class="line">$ sudo vim /etc/udev/rules.d/51-android.rules</span><br></pre></td></tr></table></figure>

<p>在<code>51-android.rules</code>文件中，按照如下格式进行配置。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#HTC</span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTR&#123;idVendor&#125;==<span class="string">"0bb4"</span>, MODE=<span class="string">"0664"</span>, GROUP=<span class="string">"plugdev"</span></span><br></pre></td></tr></table></figure>

<p>在该配置文件中：</p>
<ul>
<li><code>ATTR{idVendor}</code>：设备厂商的编号，每个厂商都有专属的唯一编号，例如HTC的venderID为<code>0bb4</code></li>
<li><code>MODE</code>：指定了对该类设备的操作权限，通常设置为<code>0664</code></li>
<li><code>GROUP</code>：指定了该类设备的用户组，通常设置为<code>plugdev</code></li>
</ul>
<p>对于venderID，可以在此处查看到主流厂商的编号：<a href="http://developer.android.com/tools/device.html#VendorIds" target="_blank" rel="noopener">all vendors listed by Google</a><br>除此之外，也可以将手机通过USB连接至电脑，采用<code>lsusb</code>命令进行查看。该命令会列出连接至电脑的所有设备，<code>ID</code>属性值即为设备厂商的venderID。例如，在如下命令执行返回结果中可以看到，HTC的venderID为<code>0bb4</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ lsusb</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 004: ID 0e0f:0002 VMware, Inc. Virtual USB Hub</span><br><span class="line">Bus 001 Device 003: ID 0e0f:0002 VMware, Inc. Virtual USB Hub</span><br><span class="line">Bus 001 Device 033: ID 0bb4:0cd6 HTC (High Tech Computer Corp.)</span><br><span class="line">Bus 001 Device 002: ID 0e0f:0003 VMware, Inc. Virtual Mouse</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 004 Device 002: ID 0e0f:0002 VMware, Inc. Virtual USB Hub</span><br><span class="line">Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span><br></pre></td></tr></table></figure>

<p>对<code>udev</code>配置完成后还不能即时生效，需要重启系统，或者重启<code>udev</code>才能使其生效。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/udev restart</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">"(udevadm control --reload-rules &amp;&amp; udevadm trigger --action=change)"</span></span><br></pre></td></tr></table></figure>

<p>再次将手机通过USB连接至电脑后，系统便能检测到设备。</p>
<h3 id="配置用户组"><a href="#配置用户组" class="headerlink" title="配置用户组"></a>配置用户组</h3><p>如果当前登录用户不在<code>plugdev</code>用户组内，采用adb或者fastboot工具进行调试的时候需要<code>sudo</code>权限。为了避免每次都这么麻烦，可以将当前登录用户添加至<code>plugdev</code>用户组。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">leo@debian8:~$ groups</span><br><span class="line">leo cdrom floppy audio dip video netdev scanner lpadmin    <span class="comment"># 可以看出，当前用户leo并不在用户组plugdev里面</span></span><br><span class="line">leo@debian8:~$ sudo gpasswd -a username plugdev            <span class="comment"># 将用户leo添加至用户组plugdev</span></span><br><span class="line">leo@debian8:~$ groups</span><br><span class="line">leo cdrom floppy audio dip video plugdev netdev scanner lpadmin    <span class="comment"># 用户leo已属于用户组plugdev</span></span><br></pre></td></tr></table></figure>

<h3 id="RSA指纹密钥认证"><a href="#RSA指纹密钥认证" class="headerlink" title="RSA指纹密钥认证"></a>RSA指纹密钥认证</h3><p>对于<code>4.2.2</code>及以上的Android版本，将手机开启USB调试模式并连接至电脑以后，手机屏幕上会出现电脑的RSA指纹密钥验证确认请求，这是Android的一套安全机制，只有点击确认以后才能从电脑上通过adb命令与手机建立调试连接。通常，勾选【Always allow from this computer】并点击确认后，手机便与电脑建立了认证连接，之后即可在电脑上采用<code>adb</code>、<code>fastboot</code>工具对手机进行操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">HT259W103035	unauthorized    <span class="comment"># 若为进行RSA指纹密钥验证确认，则会出现unauthorized提示</span></span><br><span class="line"></span><br><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">HT259W103035	device          <span class="comment"># 显示device，则说明已经建立了调试连接</span></span><br></pre></td></tr></table></figure>

<p>需要说明的是，对于<code>4.2.2</code>及以上的Android版本，adb版本要求<code>1.0.31</code>及以上，对应的Android SDK的版本要求为<code>r16.0.1</code>及以上。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://debugtalk.com/post/blackbox-testing-method-boundary-value-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="debugtalk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/xiaojianguo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DebugTalk">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/post/blackbox-testing-method-boundary-value-analysis/" class="post-title-link" itemprop="url">黑盒测试用例设计技术--边界值分析法</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-03-19 00:00:00" itemprop="dateCreated datePublished" datetime="2015-03-19T00:00:00+08:00">2015-03-19</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/" itemprop="url" rel="index"><span itemprop="name">3. Testing</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3-Testing/功能测试/" itemprop="url" rel="index"><span itemprop="name">功能测试</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文通过案例的形式，详细讲解黑盒测试用例设计技术中的边界值分析法。</p>
<p>无数的测试实践表明，大量的故障往往发生在输入定义域或输出值域的边界上，而不是在其内部。因此，针对各种边界情况设计测试用例，通常会取得很好的测试效果。<br>边界值分析法就是对输入或输出的边界值进行测试的一种黑盒测试方法，通常作为对等价类划分法的补充，其测试用例来自等价类的边界。<br>边界值分析使用与等价类划分法相同的划分，只是边界值分析假定错误更多地存在于划分的边界上，因此在等价类的边界上以及两侧的情况设计测试用例。</p>
<p>如果你对等价类划分法还不了解，可先阅读<a href="!--￼0--">【黑盒测试用例设计技术–等价类划分法】</a>。</p>
<h2 id="对边界值设计测试用例的原则"><a href="#对边界值设计测试用例的原则" class="headerlink" title="对边界值设计测试用例的原则"></a>对边界值设计测试用例的原则</h2><p>（1）如果输入条件规定了值的范围，则应取刚达到这个范围的边界值以及刚刚超过这个范围边界的值作为测试输入数据。<br>（2）如果输入条件规定了值的个数，则用最大个数、最小个数和比最大个数多1个、比最小个数少1个的数作为测试数据。<br>（3）根据程序规格说明的每个输出条件，使用原则（1）。<br>（4）根据程序规格说明的每个输出条件，使用原则（2）。<br>（5）如果程序的规格说明给出的输入域或输出域是有序集合（如有序表、顺序文件等），则应选取集合中的第一个和最后一个元素作为测试用例。<br>（6）如果程序中使用了一个内部数据结构，则应当选择这个内部数据结构的边界上的值作为测试用例。<br>（7）分析程序规格说明，找出其它可能的边界条件。</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><hr>
<blockquote>
<p>某程序具有如下功能：文本框要求输入日期信息，日期限定在1990年1月~2049年12月，并规定日期由6位数字字符组成，前4位表示年，后2位表示月；程序需对输入的日期有效性进行校验。<br>用等价类划分方法和边界值分析法为该程序的“日期检查功能”设计测试用例。</p>
</blockquote>
<h3 id="划分等价类-amp-选取边界值"><a href="#划分等价类-amp-选取边界值" class="headerlink" title="划分等价类 &amp; 选取边界值"></a>划分等价类 &amp; 选取边界值</h3><p>步骤一、要求输入6个数字字符yyyynn；参照等价类划分法规则5，划分为一个有效等价类和三个无效等价类。</p>
<ul>
<li>有效等价类（1）：输入6个数字字符</li>
<li>无效等价类（2）：输入6个字符，存在非数字的情况<ul>
<li>采用边界值，6个字符全为非数字：abcdef</li>
<li>采用边界值，6个字符中有1个为非数字：19930m</li>
</ul>
</li>
<li>无效等价类（3）：输入少于6个数字字符<ul>
<li>采用边界值，输入5个数字字符</li>
</ul>
</li>
<li>无效等价类（4）：输入多于6个数字字符<ul>
<li>采用边界值，输入7个数字字符</li>
</ul>
</li>
</ul>
<p>步骤二、在有效等价类（1）的基础上，参照等价类划分法规则6，对该等价类进行细分；考察6个数是否满足日期格式要求，1990&lt;=yyyy&lt;=2049，01&lt;=nn&lt;=12，参照规则，划分为一个有效等价类和四个无效等价类。</p>
<ul>
<li>有效等价类（5）：日期格式满足要求，1990&lt;=yyyy&lt;=2049，01&lt;=nn&lt;=12<ul>
<li>采用边界值，[yyyy,nn]取值为：[1990,06]，[1991,06]，[2020,06]，[2020,11]，[2020,12]</li>
</ul>
</li>
<li>无效等价类（6）：yyyy不满足要求，yyyy&lt;1990<ul>
<li>采用边界值，[yyyy,nn]取值为：[1989,06]</li>
</ul>
</li>
<li>无效等价类（7）：yyyy不满足要求，yyyy&gt;2049<ul>
<li>采用边界值，[yyyy,nn]取值为：[2050,06]</li>
</ul>
</li>
<li>无效等价类（8）：nn不满足要求，nn&lt;01<ul>
<li>采用边界值，[yyyy,nn]取值为：[2020,00]</li>
</ul>
</li>
<li>无效等价类（9）：nn不满足要求，nn&gt;12<ul>
<li>采用边界值，[yyyy,nn]取值为：[2020,13]</li>
</ul>
</li>
</ul>
<h3 id="设计测试用例"><a href="#设计测试用例" class="headerlink" title="设计测试用例"></a>设计测试用例</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">yyyynn</th>
<th align="center">覆盖等价类</th>
<th align="center">预期输出结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">覆盖有效等价类和边界值</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">199006</td>
<td align="center">（1）（5）</td>
<td align="center">日期格式有效</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">199106</td>
<td align="center">（1）（5）</td>
<td align="center">日期格式有效</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">202006</td>
<td align="center">（1）（5）</td>
<td align="center">日期格式有效</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">202011</td>
<td align="center">（1）（5）</td>
<td align="center">日期格式有效</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">202012</td>
<td align="center">（1）（5）</td>
<td align="center">日期格式有效</td>
</tr>
<tr>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">覆盖无效等价类和边界值</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">abcdef</td>
<td align="center">（2）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">19930m</td>
<td align="center">（2）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">19935</td>
<td align="center">（3）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">1993050</td>
<td align="center">（4）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">198906</td>
<td align="center">（6）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">205006</td>
<td align="center">（7）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">202000</td>
<td align="center">（8）</td>
<td align="center">日期格式无效</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">202013</td>
<td align="center">（9）</td>
<td align="center">日期格式无效</td>
</tr>
</tbody></table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/xiaojianguo.jpg" alt="debugtalk">
            
              <p class="site-author-name" itemprop="name">debugtalk</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">95</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">60</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/debugtalk" title="GitHub &rarr; https://github.com/debugtalk" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:mail@debugtalk.com" title="E-Mail &rarr; mailto:mail@debugtalk.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  
    <div id="sidebar-dimmer"></div>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">debugtalk</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>







  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1257477005&web_id=1257477005"></script>
  </div>



        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  

  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
